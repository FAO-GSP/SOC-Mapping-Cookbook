<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Soil Organic Carbon Mapping Cookbook</title>
  <meta name="description" content="The soilll cookbook.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Soil Organic Carbon Mapping Cookbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="The soilll cookbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Soil Organic Carbon Mapping Cookbook" />
  
  <meta name="twitter:description" content="The soilll cookbook." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2018">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chvalidation.html">
<link rel="next" href="uncertainty.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>List of contributors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#editorial-board"><i class="fa fa-check"></i>Editorial board</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-authors"><i class="fa fa-check"></i>Contributing authors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>1</b> Presentation</a><ul>
<li class="chapter" data-level="1.1" data-path="presentation.html"><a href="presentation.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> How to use this book</a></li>
<li class="chapter" data-level="1.2" data-path="presentation.html"><a href="presentation.html#the-fyrom-soil-database"><i class="fa fa-check"></i><b>1.2</b> The FYROM soil database</a></li>
<li class="chapter" data-level="1.3" data-path="presentation.html"><a href="presentation.html#foreword-to-the-first-edition"><i class="fa fa-check"></i><b>1.3</b> Foreword to the first edition</a></li>
<li class="chapter" data-level="1.4" data-path="presentation.html"><a href="presentation.html#foreword-to-the-second-edition"><i class="fa fa-check"></i><b>1.4</b> Foreword to the second edition</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="soil-property-maps.html"><a href="soil-property-maps.html"><i class="fa fa-check"></i><b>2</b> Soil property maps</a><ul>
<li class="chapter" data-level="2.1" data-path="soil-property-maps.html"><a href="soil-property-maps.html#definitions-and-objectives"><i class="fa fa-check"></i><b>2.1</b> Definitions and objectives</a></li>
<li class="chapter" data-level="2.2" data-path="soil-property-maps.html"><a href="soil-property-maps.html#generic-mapping-of-soil-grids-upscaling-of-plot-level-measurements-and-estimates"><i class="fa fa-check"></i><b>2.2</b> Generic mapping of soil grids: upscaling of plot-Level measurements and estimates</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html"><i class="fa fa-check"></i><b>3</b> Setting-up the software environment</a><ul>
<li class="chapter" data-level="3.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#use-of-r-rstudio-and-r-packages"><i class="fa fa-check"></i><b>3.1</b> Use of R, RStudio and R Packages</a><ul>
<li class="chapter" data-level="3.1.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>3.1.1</b> Obtaining and installing R</a></li>
<li class="chapter" data-level="3.1.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>3.1.2</b> Obtaining and installing RStudio</a></li>
<li class="chapter" data-level="3.1.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#getting-started-with-r"><i class="fa fa-check"></i><b>3.1.3</b> Getting started with R</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#r-packages"><i class="fa fa-check"></i><b>3.2</b> R packages</a><ul>
<li class="chapter" data-level="3.2.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#finding-r-packages"><i class="fa fa-check"></i><b>3.2.1</b> Finding R packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#most-used-r-packages-for-digital-soil-mapping"><i class="fa fa-check"></i><b>3.2.2</b> Most used R packages for digital soil mapping</a></li>
<li class="chapter" data-level="3.2.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#packages-used-in-this-cookbook"><i class="fa fa-check"></i><b>3.2.3</b> Packages used in this cookbook</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#r-and-spatial-data"><i class="fa fa-check"></i><b>3.3</b> R and spatial data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#reading-shapefiles"><i class="fa fa-check"></i><b>3.3.1</b> Reading shapefiles</a></li>
<li class="chapter" data-level="3.3.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#coordinate-reference-systems-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Coordinate reference systems in R</a></li>
<li class="chapter" data-level="3.3.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#working-with-rasters"><i class="fa fa-check"></i><b>3.3.3</b> Working with rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#other-dsm-software-and-tools"><i class="fa fa-check"></i><b>3.4</b> Other DSM software and tools</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>4</b> Preparation of local soil data</a><ul>
<li class="chapter" data-level="4.1" data-path="preparation.html"><a href="preparation.html#soil-profiles-and-soil-augers"><i class="fa fa-check"></i><b>4.1</b> Soil profiles and soil augers</a></li>
<li class="chapter" data-level="4.2" data-path="preparation.html"><a href="preparation.html#soil-database"><i class="fa fa-check"></i><b>4.2</b> Soil database</a><ul>
<li class="chapter" data-level="4.2.1" data-path="preparation.html"><a href="preparation.html#type-of-soil-database"><i class="fa fa-check"></i><b>4.2.1</b> Type of soil database</a></li>
<li class="chapter" data-level="4.2.2" data-path="preparation.html"><a href="preparation.html#technical-steps-loading-soil-data-from-tables-in-r"><i class="fa fa-check"></i><b>4.2.2</b> Technical steps – Loading soil data from tables in R</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="preparation.html"><a href="preparation.html#completeness-of-measurements-and-estimates"><i class="fa fa-check"></i><b>4.3</b> Completeness of measurements and estimates</a><ul>
<li class="chapter" data-level="4.3.1" data-path="preparation.html"><a href="preparation.html#stones"><i class="fa fa-check"></i><b>4.3.1</b> Stones</a></li>
<li class="chapter" data-level="4.3.2" data-path="preparation.html"><a href="preparation.html#bulk-density"><i class="fa fa-check"></i><b>4.3.2</b> Bulk density</a></li>
<li class="chapter" data-level="4.3.3" data-path="preparation.html"><a href="preparation.html#soil-carbon-analysis"><i class="fa fa-check"></i><b>4.3.3</b> Soil carbon analysis</a></li>
<li class="chapter" data-level="4.3.4" data-path="preparation.html"><a href="preparation.html#carbonates"><i class="fa fa-check"></i><b>4.3.4</b> Carbonates</a></li>
<li class="chapter" data-level="4.3.5" data-path="preparation.html"><a href="preparation.html#depth"><i class="fa fa-check"></i><b>4.3.5</b> Depth</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="preparation.html"><a href="preparation.html#soil-depth-estimate"><i class="fa fa-check"></i><b>4.4</b> Soil depth estimate</a><ul>
<li class="chapter" data-level="4.4.1" data-path="preparation.html"><a href="preparation.html#completeness-of-depth-estimate"><i class="fa fa-check"></i><b>4.4.1</b> Completeness of depth estimate</a></li>
<li class="chapter" data-level="4.4.2" data-path="preparation.html"><a href="preparation.html#EqualAreaSplines"><i class="fa fa-check"></i><b>4.4.2</b> Technical steps - Equal-area splines using R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="covariates.html"><a href="covariates.html"><i class="fa fa-check"></i><b>5</b> Preparation of spatial covariates</a><ul>
<li class="chapter" data-level="5.1" data-path="covariates.html"><a href="covariates.html#dem-derived-covariates"><i class="fa fa-check"></i><b>5.1</b> DEM-derived covariates</a></li>
<li class="chapter" data-level="5.2" data-path="covariates.html"><a href="covariates.html#parent-material"><i class="fa fa-check"></i><b>5.2</b> Parent material</a></li>
<li class="chapter" data-level="5.3" data-path="covariates.html"><a href="covariates.html#soil-maps"><i class="fa fa-check"></i><b>5.3</b> Soil maps</a><ul>
<li class="chapter" data-level="5.3.1" data-path="covariates.html"><a href="covariates.html#global-hwsd-soil-property-maps"><i class="fa fa-check"></i><b>5.3.1</b> Global HWSD soil property maps</a></li>
<li class="chapter" data-level="5.3.2" data-path="covariates.html"><a href="covariates.html#technical-steps---rasterizing-a-vector-layer-in-r"><i class="fa fa-check"></i><b>5.3.2</b> Technical steps - Rasterizing a vector layer in R</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="covariates.html"><a href="covariates.html#land-cover-and-land-use"><i class="fa fa-check"></i><b>5.4</b> Land cover and land use</a><ul>
<li class="chapter" data-level="5.4.1" data-path="covariates.html"><a href="covariates.html#globcover-global"><i class="fa fa-check"></i><b>5.4.1</b> GlobCover (Global)</a></li>
<li class="chapter" data-level="5.4.2" data-path="covariates.html"><a href="covariates.html#landsat-geocover-global"><i class="fa fa-check"></i><b>5.4.2</b> Landsat GeoCover (Global)</a></li>
<li class="chapter" data-level="5.4.3" data-path="covariates.html"><a href="covariates.html#globeland30-global"><i class="fa fa-check"></i><b>5.4.3</b> GlobeLand30 (Global)</a></li>
<li class="chapter" data-level="5.4.4" data-path="covariates.html"><a href="covariates.html#corine-land-cover-europe-only"><i class="fa fa-check"></i><b>5.4.4</b> CORINE land cover (Europe only)</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="covariates.html"><a href="covariates.html#climate"><i class="fa fa-check"></i><b>5.5</b> Climate</a><ul>
<li class="chapter" data-level="5.5.1" data-path="covariates.html"><a href="covariates.html#worldclim-v1.4-and-v2-global"><i class="fa fa-check"></i><b>5.5.1</b> WorldClim V1.4 and V2 (Global)</a></li>
<li class="chapter" data-level="5.5.2" data-path="covariates.html"><a href="covariates.html#gridded-agro-meteorological-data-in-europe-europe"><i class="fa fa-check"></i><b>5.5.2</b> Gridded agro-meteorological data in Europe (Europe)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="covariates.html"><a href="covariates.html#GSOCDataRepo"><i class="fa fa-check"></i><b>5.6</b> GSOCMap - Data repository (ISRIC, 2017)</a><ul>
<li class="chapter" data-level="5.6.1" data-path="covariates.html"><a href="covariates.html#covariates-and-empty-mask"><i class="fa fa-check"></i><b>5.6.1</b> Covariates and empty mask</a></li>
<li class="chapter" data-level="5.6.2" data-path="covariates.html"><a href="covariates.html#data-specifications"><i class="fa fa-check"></i><b>5.6.2</b> Data specifications</a></li>
<li class="chapter" data-level="5.6.3" data-path="covariates.html"><a href="covariates.html#data-access"><i class="fa fa-check"></i><b>5.6.3</b> Data access</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="covariates.html"><a href="covariates.html#extending-the-soil-property-table-for-spatial-statistics"><i class="fa fa-check"></i><b>5.7</b> Extending the soil property table for spatial statistics</a></li>
<li class="chapter" data-level="5.8" data-path="covariates.html"><a href="covariates.html#preparation-of-a-soil-property-table-for-spatial-statistics"><i class="fa fa-check"></i><b>5.8</b> Preparation of a soil property table for spatial statistics</a></li>
<li class="chapter" data-level="5.9" data-path="covariates.html"><a href="covariates.html#overlay-soil-covariates"><i class="fa fa-check"></i><b>5.9</b> Technical steps - Overlay covariates and soil points data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mappingMethods.html"><a href="mappingMethods.html"><i class="fa fa-check"></i><b>6</b> Mapping methods</a><ul>
<li class="chapter" data-level="6.1" data-path="mappingMethods.html"><a href="mappingMethods.html#convUpscaling"><i class="fa fa-check"></i><b>6.1</b> Conventional upscaling using soil maps</a><ul>
<li class="chapter" data-level="6.1.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
<li class="chapter" data-level="6.1.2" data-path="mappingMethods.html"><a href="mappingMethods.html#diversity-of-national-soil-legacy-data-sets"><i class="fa fa-check"></i><b>6.1.2</b> Diversity of national soil legacy data sets</a></li>
<li class="chapter" data-level="6.1.3" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---class-matching"><i class="fa fa-check"></i><b>6.1.3</b> Technical steps - Class-matching</a></li>
<li class="chapter" data-level="6.1.4" data-path="mappingMethods.html"><a href="mappingMethods.html#geomQGIS"><i class="fa fa-check"></i><b>6.1.4</b> Technical steps - Geo-matching</a></li>
<li class="chapter" data-level="6.1.5" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---geo-matching-soc-with-wrb-soil-map-in-r"><i class="fa fa-check"></i><b>6.1.5</b> Technical steps - Geo-matching SOC with WRB soil map in R</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="mappingMethods.html"><a href="mappingMethods.html#RK"><i class="fa fa-check"></i><b>6.2</b> Regression-Kriging</a><ul>
<li class="chapter" data-level="6.2.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-1"><i class="fa fa-check"></i><b>6.2.1</b> Overview</a></li>
<li class="chapter" data-level="6.2.2" data-path="mappingMethods.html"><a href="mappingMethods.html#assumptions"><i class="fa fa-check"></i><b>6.2.2</b> Assumptions</a></li>
<li class="chapter" data-level="6.2.3" data-path="mappingMethods.html"><a href="mappingMethods.html#pre-processing-of-covariates"><i class="fa fa-check"></i><b>6.2.3</b> Pre-processing of covariates</a></li>
<li class="chapter" data-level="6.2.4" data-path="mappingMethods.html"><a href="mappingMethods.html#the-terminology"><i class="fa fa-check"></i><b>6.2.4</b> The terminology</a></li>
<li class="chapter" data-level="6.2.5" data-path="mappingMethods.html"><a href="mappingMethods.html#interpret-the-key-results-of-multiple-regression"><i class="fa fa-check"></i><b>6.2.5</b> Interpret the Key Results of Multiple Regression</a></li>
<li class="chapter" data-level="6.2.6" data-path="mappingMethods.html"><a href="mappingMethods.html#using-the-results-of-a-regression-analysis-to-make-predictions"><i class="fa fa-check"></i><b>6.2.6</b> Using the results of a regression analysis to make predictions</a></li>
<li class="chapter" data-level="6.2.7" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---regression-kriging"><i class="fa fa-check"></i><b>6.2.7</b> Technical steps - Regression-kriging</a></li>
<li class="chapter" data-level="6.2.8" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---cross-validation-of-regression-kriging-models"><i class="fa fa-check"></i><b>6.2.8</b> Technical steps - Cross-validation of regression-kriging models</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="mappingMethods.html"><a href="mappingMethods.html#rf"><i class="fa fa-check"></i><b>6.3</b> Data mining: random forest</a><ul>
<li class="chapter" data-level="6.3.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-2"><i class="fa fa-check"></i><b>6.3.1</b> Overview</a></li>
<li class="chapter" data-level="6.3.2" data-path="mappingMethods.html"><a href="mappingMethods.html#random-forest"><i class="fa fa-check"></i><b>6.3.2</b> Random forest</a></li>
<li class="chapter" data-level="6.3.3" data-path="mappingMethods.html"><a href="mappingMethods.html#conceptual-model-and-data-preparation"><i class="fa fa-check"></i><b>6.3.3</b> Conceptual model and data preparation</a></li>
<li class="chapter" data-level="6.3.4" data-path="mappingMethods.html"><a href="mappingMethods.html#software"><i class="fa fa-check"></i><b>6.3.4</b> Software</a></li>
<li class="chapter" data-level="6.3.5" data-path="mappingMethods.html"><a href="mappingMethods.html#tunning-random-forest-model-parameters"><i class="fa fa-check"></i><b>6.3.5</b> Tunning random forest model parameters</a></li>
<li class="chapter" data-level="6.3.6" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---random-forest"><i class="fa fa-check"></i><b>6.3.6</b> Technical steps - Random forest</a></li>
<li class="chapter" data-level="6.3.7" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---using-quantile-regression-forest-to-estimate-uncertainty"><i class="fa fa-check"></i><b>6.3.7</b> Technical steps - Using quantile regression forest to estimate uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mappingMethods.html"><a href="mappingMethods.html#svm"><i class="fa fa-check"></i><b>6.4</b> Data mining: support vector machines</a><ul>
<li class="chapter" data-level="6.4.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-3"><i class="fa fa-check"></i><b>6.4.1</b> Overview</a></li>
<li class="chapter" data-level="6.4.2" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---fitting-an-svm-model-to-predict-the-soc"><i class="fa fa-check"></i><b>6.4.2</b> Technical steps - Fitting an SVM model to predict the SOC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chvalidation.html"><a href="chvalidation.html"><i class="fa fa-check"></i><b>7</b> Validation</a><ul>
<li class="chapter" data-level="7.1" data-path="chvalidation.html"><a href="chvalidation.html#what-is-validation"><i class="fa fa-check"></i><b>7.1</b> What is validation?</a></li>
<li class="chapter" data-level="7.2" data-path="chvalidation.html"><a href="chvalidation.html#QualMeasures"><i class="fa fa-check"></i><b>7.2</b> Map quality measures</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chvalidation.html"><a href="chvalidation.html#quality-measures-for-quantitative-soil-maps"><i class="fa fa-check"></i><b>7.2.1</b> Quality measures for quantitative soil maps</a></li>
<li class="chapter" data-level="7.2.2" data-path="chvalidation.html"><a href="chvalidation.html#quality-measures-for-qualitative-soil-maps"><i class="fa fa-check"></i><b>7.2.2</b> Quality measures for qualitative soil maps</a></li>
<li class="chapter" data-level="7.2.3" data-path="chvalidation.html"><a href="chvalidation.html#estimating-the-map-quality-measures-and-associated-uncertainty"><i class="fa fa-check"></i><b>7.2.3</b> Estimating the map quality measures and associated uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chvalidation.html"><a href="chvalidation.html#graphical-map-quality-measures"><i class="fa fa-check"></i><b>7.3</b> Graphical map quality measures</a></li>
<li class="chapter" data-level="7.4" data-path="chvalidation.html"><a href="chvalidation.html#validationMeth"><i class="fa fa-check"></i><b>7.4</b> Validation methods and statistical inference</a><ul>
<li class="chapter" data-level="7.4.1" data-path="chvalidation.html"><a href="chvalidation.html#addProbSampling"><i class="fa fa-check"></i><b>7.4.1</b> Additional probability sampling</a></li>
<li class="chapter" data-level="7.4.2" data-path="chvalidation.html"><a href="chvalidation.html#data-splitting"><i class="fa fa-check"></i><b>7.4.2</b> Data-splitting</a></li>
<li class="chapter" data-level="7.4.3" data-path="chvalidation.html"><a href="chvalidation.html#xval"><i class="fa fa-check"></i><b>7.4.3</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="chvalidation.html"><a href="chvalidation.html#TS:validation"><i class="fa fa-check"></i><b>7.5</b> Technical steps - Validation</a></li>
<li class="chapter" data-level="7.6" data-path="chvalidation.html"><a href="chvalidation.html#dataSplit"><i class="fa fa-check"></i><b>7.6</b> Technical steps - Data-splitting</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>8</b> Model evaluation in digital soil mapping</a><ul>
<li class="chapter" data-level="8.1" data-path="evaluation.html"><a href="evaluation.html#technical-steps---model-correlations-and-spatial-differences"><i class="fa fa-check"></i><b>8.1</b> Technical steps - Model correlations and spatial differences</a></li>
<li class="chapter" data-level="8.2" data-path="evaluation.html"><a href="evaluation.html#technical-steps---model-evaluation"><i class="fa fa-check"></i><b>8.2</b> Technical steps - Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>9</b> Uncertainty</a><ul>
<li class="chapter" data-level="9.1" data-path="uncertainty.html"><a href="uncertainty.html#sourcesuncert"><i class="fa fa-check"></i><b>9.1</b> Sources of uncertainty</a><ul>
<li class="chapter" data-level="9.1.1" data-path="uncertainty.html"><a href="uncertainty.html#attribute-uncertainty-of-soil-measurements"><i class="fa fa-check"></i><b>9.1.1</b> Attribute uncertainty of soil measurements</a></li>
<li class="chapter" data-level="9.1.2" data-path="uncertainty.html"><a href="uncertainty.html#positional-uncertainty-of-soil-measurements"><i class="fa fa-check"></i><b>9.1.2</b> Positional uncertainty of soil measurements</a></li>
<li class="chapter" data-level="9.1.3" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-in-covariates"><i class="fa fa-check"></i><b>9.1.3</b> Uncertainty in covariates</a></li>
<li class="chapter" data-level="9.1.4" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-in-models-predicting-soil-properties-from-covariates-and-soil-point-data"><i class="fa fa-check"></i><b>9.1.4</b> Uncertainty in models predicting soil properties from covariates and soil point data</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-and-spatial-data-quality"><i class="fa fa-check"></i><b>9.2</b> Uncertainty and spatial data quality</a></li>
<li class="chapter" data-level="9.3" data-path="uncertainty.html"><a href="uncertainty.html#quantifying-prediction-uncertainty"><i class="fa fa-check"></i><b>9.3</b> Quantifying prediction uncertainty</a><ul>
<li class="chapter" data-level="9.3.1" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-characterised-by-probability-distributions"><i class="fa fa-check"></i><b>9.3.1</b> Uncertainty characterised by probability distributions</a></li>
<li class="chapter" data-level="9.3.2" data-path="uncertainty.html"><a href="uncertainty.html#propagation-of-model-uncertainty"><i class="fa fa-check"></i><b>9.3.2</b> Propagation of model uncertainty</a></li>
<li class="chapter" data-level="9.3.3" data-path="uncertainty.html"><a href="uncertainty.html#propUncertainty"><i class="fa fa-check"></i><b>9.3.3</b> Propagation of attribute, positional and covariate uncertainty</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-sharing.html"><a href="data-sharing.html"><i class="fa fa-check"></i><b>10</b> Data sharing</a><ul>
<li class="chapter" data-level="10.1" data-path="data-sharing.html"><a href="data-sharing.html#export-formats"><i class="fa fa-check"></i><b>10.1</b> Export formats</a><ul>
<li class="chapter" data-level="10.1.1" data-path="data-sharing.html"><a href="data-sharing.html#type-of-soil-data-and-their-formatting"><i class="fa fa-check"></i><b>10.1.1</b> Type of soil data and their formatting</a></li>
<li class="chapter" data-level="10.1.2" data-path="data-sharing.html"><a href="data-sharing.html#general-gis-data-formats-vector-raster-table"><i class="fa fa-check"></i><b>10.1.2</b> General GIS data formats: vector, raster, table</a></li>
<li class="chapter" data-level="10.1.3" data-path="data-sharing.html"><a href="data-sharing.html#recommended-gis-data-exchange-formats"><i class="fa fa-check"></i><b>10.1.3</b> Recommended GIS data exchange formats</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="data-sharing.html"><a href="data-sharing.html#webService"><i class="fa fa-check"></i><b>10.2</b> Web services: serving soil data using web technology</a><ul>
<li class="chapter" data-level="10.2.1" data-path="data-sharing.html"><a href="data-sharing.html#third-party-services"><i class="fa fa-check"></i><b>10.2.1</b> Third-party services</a></li>
<li class="chapter" data-level="10.2.2" data-path="data-sharing.html"><a href="data-sharing.html#geoserver-web-serving-and-web-processing"><i class="fa fa-check"></i><b>10.2.2</b> GeoServer (web serving and web processing)</a></li>
<li class="chapter" data-level="10.2.3" data-path="data-sharing.html"><a href="data-sharing.html#visualizing-data-using-leaflet-andor-google-earth"><i class="fa fa-check"></i><b>10.2.3</b> Visualizing data using Leaflet and/or Google Earth</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="data-sharing.html"><a href="data-sharing.html#preparing-soil-data-for-distribution"><i class="fa fa-check"></i><b>10.3</b> Preparing soil data for distribution</a><ul>
<li class="chapter" data-level="10.3.1" data-path="data-sharing.html"><a href="data-sharing.html#metadata"><i class="fa fa-check"></i><b>10.3.1</b> Metadata</a></li>
<li class="chapter" data-level="10.3.2" data-path="data-sharing.html"><a href="data-sharing.html#exporting-data-final-tips"><i class="fa fa-check"></i><b>10.3.2</b> Exporting data: final tips</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="data-sharing.html"><a href="data-sharing.html#export-formats-1"><i class="fa fa-check"></i><b>10.4</b> Export formats</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html"><i class="fa fa-check"></i><b>11</b> Technical overview and the checklist</a><ul>
<li class="chapter" data-level="11.1" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#point-dataset"><i class="fa fa-check"></i><b>11.1</b> Point dataset</a></li>
<li class="chapter" data-level="11.2" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#covariates-1"><i class="fa fa-check"></i><b>11.2</b> Covariates</a></li>
<li class="chapter" data-level="11.3" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#statistical-inference"><i class="fa fa-check"></i><b>11.3</b> Statistical inference</a></li>
<li class="chapter" data-level="11.4" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#spatial-interpolation"><i class="fa fa-check"></i><b>11.4</b> Spatial interpolation</a></li>
<li class="chapter" data-level="11.5" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#calculation-of-stocks"><i class="fa fa-check"></i><b>11.5</b> Calculation of stocks</a></li>
<li class="chapter" data-level="11.6" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#evaluation-of-output-and-quality-assessment"><i class="fa fa-check"></i><b>11.6</b> Evaluation of output and quality assessment</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="compendium.html"><a href="compendium.html"><i class="fa fa-check"></i><b>12</b> Compendium of the code examples</a><ul>
<li class="chapter" data-level="12.1" data-path="compendium.html"><a href="compendium.html#cd:PreparationProfiles"><i class="fa fa-check"></i><b>12.1</b> Data preparation for soil profiles</a></li>
<li class="chapter" data-level="12.2" data-path="compendium.html"><a href="compendium.html#cd:PreparationAuger"><i class="fa fa-check"></i><b>12.2</b> Data preparation for topsoil or auger samples</a></li>
<li class="chapter" data-level="12.3" data-path="compendium.html"><a href="compendium.html#cd:merging"><i class="fa fa-check"></i><b>12.3</b> Merging topsoil or auger samples and soil profiles databases</a></li>
<li class="chapter" data-level="12.4" data-path="compendium.html"><a href="compendium.html#cd:data-splitting"><i class="fa fa-check"></i><b>12.4</b> Data-splitting</a></li>
<li class="chapter" data-level="12.5" data-path="compendium.html"><a href="compendium.html#cd:Rasterizing"><i class="fa fa-check"></i><b>12.5</b> Rasterizing a vector layer in R</a></li>
<li class="chapter" data-level="12.6" data-path="compendium.html"><a href="compendium.html#cd:Overlay"><i class="fa fa-check"></i><b>12.6</b> Overlay covariates and soil points data</a></li>
<li class="chapter" data-level="12.7" data-path="compendium.html"><a href="compendium.html#cd:RK"><i class="fa fa-check"></i><b>12.7</b> Fitting a regression-kriging model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.8" data-path="compendium.html"><a href="compendium.html#cd:xvalRK"><i class="fa fa-check"></i><b>12.8</b> Cross-validation of regression-kriging models</a></li>
<li class="chapter" data-level="12.9" data-path="compendium.html"><a href="compendium.html#cd:rf"><i class="fa fa-check"></i><b>12.9</b> Fitting a random forest model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.10" data-path="compendium.html"><a href="compendium.html#cd:quantreg"><i class="fa fa-check"></i><b>12.10</b> Using quantile regression forest to estimate uncertainty</a></li>
<li class="chapter" data-level="12.11" data-path="compendium.html"><a href="compendium.html#cd:svm"><i class="fa fa-check"></i><b>12.11</b> Fitting a support vector machines model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.12" data-path="compendium.html"><a href="compendium.html#cd:Validation"><i class="fa fa-check"></i><b>12.12</b> Validation</a></li>
<li class="chapter" data-level="12.13" data-path="compendium.html"><a href="compendium.html#cd:Graphs"><i class="fa fa-check"></i><b>12.13</b> Graphical map quality measures</a></li>
<li class="chapter" data-level="12.14" data-path="compendium.html"><a href="compendium.html#cd:Evaluation"><i class="fa fa-check"></i><b>12.14</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Soil Organic Carbon Mapping Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="evaluation" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Model evaluation in digital soil mapping</h1>
<p><em>M. Guevara &amp; G.F. Olmedo</em></p>
<p>There are no best methods for statistical modeling and different evaluation strategies should be considered in order to identify, realistically, the overall modeling accuracy <span class="citation">(Ho and Pepyne <a href="#ref-ho2002simple">2002</a>; Qiao, Soberón, and Peterson <a href="#ref-qiao2015no">2015</a>; Guevara et al. <a href="#ref-guevara_2018">2018</a>; Nussbaum et al. <a href="#ref-nussbaum2018evaluation">2018</a>)</span>. This Section is devoted to describe quantitative methods for model evaluation applied to SOC mapping across FYROM.</p>
<p>Our objective is to provide a model evaluation example based on a vector of observed SOC and a vector of modeled SOC estimates derived from three different statistical methods describes in Chapter <a href="mappingMethods.html#mappingMethods">6</a>: multiple linear regression-kriging (RK) (see Section <a href="mappingMethods.html#RK">6.2</a>), random forests (RF) (see Section <a href="mappingMethods.html#rf">6.3</a>), and support vector machines (SVM) (see Section <a href="mappingMethods.html#svm">6.4</a>)). The model evaluation methods presented here were adapted from the original work of <span class="citation">Carslaw and Ropkins (<a href="#ref-openair">2012</a>)</span> for air quality assessments and their <strong>R</strong> package <strong>openair</strong>.</p>
<p>We found in this package a very useful set of functions for model evaluation metrics that are suitable (and we highly recommend) for comparing digital soil maps derived from different prediction algorithms. We will first analyze the simple correlation and major differences of generated SOC maps by the three different methods. Then for further analysis we will prepare a data frame containing the observed and modeled vectors as well as the method column. Ideally the observed vector should be derived from a completely independent SOC dataset, as explained in the previous Chapter. The cross-validation strategy and the repeated random split for training and testing the models are other two alternatives when no independent dataset is available for validation purposes. However, we do not recommend to use the same training dataset for performing the following analysis, since the resulting <em>best method</em> could be the one that overfits the most.</p>
<p>The authors of this Chapter used <strong>R</strong> packages. To run the code provided in this Chapter, the following packages need to be installed in the <strong>R</strong> user library. If the packages are not yet installed, the <code>install.packages()</code> function can be used.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="co"># Installing packages for Chapter &#39;Model Evaluation in</span></a>
<a class="sourceLine" id="cb177-2" data-line-number="2"><span class="co"># Digital Soil Mapping&#39;</span></a>
<a class="sourceLine" id="cb177-3" data-line-number="3"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;raster&quot;</span>, <span class="st">&quot;psych&quot;</span>, <span class="st">&quot;rasterVis&quot;</span>,</a>
<a class="sourceLine" id="cb177-4" data-line-number="4">                   <span class="st">&quot;mapview&quot;</span>, <span class="st">&quot;openair&quot;</span>))</a></code></pre></div>
<div id="technical-steps---model-correlations-and-spatial-differences" class="section level2">
<h2><span class="header-section-number">8.1</span> Technical steps - Model correlations and spatial differences</h2>
<p><strong>Step 1 - Harmonize the predicted maps to the same spatial resolution</strong></p>
<p>We will import the predicted maps and harmonize them in to the same regular grid (<span class="math inline">\(1 \times 1\)</span> km of spatial resolution).</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"></a>
<a class="sourceLine" id="cb178-3" data-line-number="3">GM&lt;-<span class="kw">raster</span>(<span class="st">&#39;results/MKD_OCSKGM_GM.tif&#39;</span>)</a>
<a class="sourceLine" id="cb178-4" data-line-number="4">RK&lt;-<span class="kw">raster</span>(<span class="st">&#39;results/MKD_OCSKGM_RK.tif&#39;</span>)</a>
<a class="sourceLine" id="cb178-5" data-line-number="5">RF&lt;-<span class="kw">raster</span>(<span class="st">&#39;results/MKD_OCSKGM_rf.tif&#39;</span>)</a>
<a class="sourceLine" id="cb178-6" data-line-number="6">SVM&lt;-<span class="kw">raster</span>(<span class="st">&#39;results/MKD_OCSKGM_svm.tif&#39;</span>)</a>
<a class="sourceLine" id="cb178-7" data-line-number="7"></a>
<a class="sourceLine" id="cb178-8" data-line-number="8"><span class="co"># Note that RK has a different reference system </span></a>
<a class="sourceLine" id="cb178-9" data-line-number="9">RK &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(RK, SVM)</a>
<a class="sourceLine" id="cb178-10" data-line-number="10">models &lt;-<span class="st"> </span><span class="kw">stack</span>(GM, RK, RF, SVM)</a></code></pre></div>
<p><strong>Step 2 - Compare the statistical distribution and correlation between the models</strong></p>
<p>Then we will plot the statistical distribution and the correlation between the three different methods (RK, RF, SVM).</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1"><span class="kw">library</span>(psych)</a>
<a class="sourceLine" id="cb179-2" data-line-number="2"></a>
<a class="sourceLine" id="cb179-3" data-line-number="3"><span class="kw">pairs.panels</span>(<span class="kw">na.omit</span>(<span class="kw">as.data.frame</span>(models)),</a>
<a class="sourceLine" id="cb179-4" data-line-number="4">             <span class="co"># Correlation method</span></a>
<a class="sourceLine" id="cb179-5" data-line-number="5">             <span class="dt">method =</span> <span class="st">&quot;pearson&quot;</span>, </a>
<a class="sourceLine" id="cb179-6" data-line-number="6">             <span class="dt">hist.col =</span> <span class="st">&quot;#00AFBB&quot;</span>,</a>
<a class="sourceLine" id="cb179-7" data-line-number="7">             <span class="co"># Show density plots</span></a>
<a class="sourceLine" id="cb179-8" data-line-number="8">             <span class="dt">density =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb179-9" data-line-number="9">             <span class="co"># Show correlation ellipses</span></a>
<a class="sourceLine" id="cb179-10" data-line-number="10">             <span class="dt">ellipses =</span> <span class="ot">TRUE</span> </a>
<a class="sourceLine" id="cb179-11" data-line-number="11">             )</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-97"></span>
<img src="SOCMapping_files/figure-html/unnamed-chunk-97-1.png" alt="Comparision of DSM model correlations (GM, RK, RF, SVM) and statical distributions" width="672" />
<p class="caption">
Figure 8.1: Comparision of DSM model correlations (GM, RK, RF, SVM) and statical distributions
</p>
</div>
<p>Here we found that the higher Pearson correlation coefficient (<span class="math inline">\(r\)</span> value) between predicted values was between RK and SVM (0.86). We also found that the statistical distribution of predicted values is quite similar between the three methods and that the lowest correlation of predictions was found between the two machine learning approaches with <span class="math inline">\(r\)</span> 0.79 for RF and SVM.</p>
<p>We can in addition overlap the probability distribution functions for the three different methods to verify that their predictions are similar across the full data distribution of values.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="kw">library</span>(rasterVis)</a>
<a class="sourceLine" id="cb180-2" data-line-number="2"></a>
<a class="sourceLine" id="cb180-3" data-line-number="3"><span class="kw">densityplot</span>(models)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-98"></span>
<img src="SOCMapping_files/figure-html/unnamed-chunk-98-1.png" alt="Density plot of the prediction for three DSM models" width="672" />
<p class="caption">
Figure 8.2: Density plot of the prediction for three DSM models
</p>
</div>
<p><strong>Step 3 - Identify spatial differences between the models using the standard deviation</strong></p>
<p>Lets now take a look at the spatial differences. This step will allow to identify the geographical areas within the prediction domain where model predictions more agreee and disagree. To spatially compare model predictions we will estimate the standard deviation and the
differences between the three SOC maps.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="kw">library</span>(mapview)</a>
<a class="sourceLine" id="cb181-2" data-line-number="2"></a>
<a class="sourceLine" id="cb181-3" data-line-number="3">SD &lt;-<span class="st"> </span><span class="kw">calc</span>(models , sd)</a>
<a class="sourceLine" id="cb181-4" data-line-number="4"></a>
<a class="sourceLine" id="cb181-5" data-line-number="5"><span class="kw">mapview</span>(SD)</a></code></pre></div>
<p>The mapview command will plot the standard deviation map in a <code>.html</code> file. Note roughly how the hotspots (yellow to red colors) of higher variance of predictions tend to be higher towards the west of the country, whereas models tend to agree in their predictions across the east side of the country. Note also that the variability although noisy, it shows a general pattern, (e.g., from east to west), suggesting that model agreement could be associated with specific land surface characteristics.</p>
<p>Now we will analyze specific differences between the three models (RK - RF, RK - SVM, RF - SVM).</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb182-2" data-line-number="2"></a>
<a class="sourceLine" id="cb182-3" data-line-number="3">RKRF  &lt;-<span class="st"> </span><span class="kw">calc</span>(models[[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]], diff)</a>
<a class="sourceLine" id="cb182-4" data-line-number="4">RKSVM &lt;-<span class="st"> </span><span class="kw">calc</span>(models[[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]], diff)</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">RFSVM &lt;-<span class="st"> </span><span class="kw">calc</span>(models[[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]], diff)</a>
<a class="sourceLine" id="cb182-6" data-line-number="6"></a>
<a class="sourceLine" id="cb182-7" data-line-number="7">preds &lt;-<span class="st"> </span><span class="kw">stack</span>(RKRF, RKSVM, RFSVM)</a>
<a class="sourceLine" id="cb182-8" data-line-number="8"><span class="kw">names</span>(preds) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;RKvsRF&#39;</span>,<span class="st">&#39;RKvsSVM&#39;</span>,<span class="st">&#39;RFvsSVM&#39;</span>)</a>
<a class="sourceLine" id="cb182-9" data-line-number="9"></a>
<a class="sourceLine" id="cb182-10" data-line-number="10">X &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">cellStats</span>(preds, mean)</a>
<a class="sourceLine" id="cb182-11" data-line-number="11"><span class="kw">levelplot</span>(preds <span class="op">-</span><span class="st"> </span>X, <span class="dt">at=</span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>, <span class="dt">length.out=</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb182-12" data-line-number="12">          <span class="dt">par.settings =</span> RdBuTheme)</a></code></pre></div>
<p>Note how the spatial differences of the predicted SOC values have similar patterns, but the difference between RK and RF seems to be less sharp than the differences of SVM with the other two methods. Note that we use the <code>levelplot()</code> function to generate a better visualization (from red-to-white-to-blue) of the main effects of differences (e.g., if they are positive or negative), but we could also use the <code>mapview()</code> function to analyze these maps in a more interactive fashion. The variance of predictions derived from different models can be used as a proxy of model uncertainty and provides valuable information to consider in further applications of SOC maps (e.g., modeling crop production or quantifying SOC stocks).</p>
</div>
<div id="technical-steps---model-evaluation" class="section level2">
<h2><span class="header-section-number">8.2</span> Technical steps - Model evaluation</h2>
<p><strong>Step 1 - Data preparation</strong></p>
<p>To compare the performance of the four models, we will compare the observed values used and the predicted values for the the validation points. We have to load the validation dataset and the prediction result of the four models. The table containing these values was prepared in Section <a href="chvalidation.html#TS:validation">7.5</a>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;results/validation.csv&quot;</span>)</a></code></pre></div>
<p>We will prepare a new table from this data that we are going to use for model evaluation purposes. The new table should have the observed value, the predicted value and the model.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="co"># Prepare 4 new data.frame with the observed, predicted and the model</span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2">modGM &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">obs =</span> dat<span class="op">$</span>OCSKGM, <span class="dt">mod =</span> dat<span class="op">$</span>MKD_OCSKGM_GM, </a>
<a class="sourceLine" id="cb184-3" data-line-number="3">                    <span class="dt">model =</span> <span class="st">&quot;GM&quot;</span>)</a>
<a class="sourceLine" id="cb184-4" data-line-number="4"></a>
<a class="sourceLine" id="cb184-5" data-line-number="5">modRK &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">obs =</span> dat<span class="op">$</span>OCSKGM, <span class="dt">mod =</span> dat<span class="op">$</span>MKD_OCSKGM_RK, </a>
<a class="sourceLine" id="cb184-6" data-line-number="6">                    <span class="dt">model =</span> <span class="st">&quot;RK&quot;</span>)</a>
<a class="sourceLine" id="cb184-7" data-line-number="7"></a>
<a class="sourceLine" id="cb184-8" data-line-number="8">modRF &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">obs =</span> dat<span class="op">$</span>OCSKGM, <span class="dt">mod =</span> dat<span class="op">$</span>MKD_OCSKGM_rf, </a>
<a class="sourceLine" id="cb184-9" data-line-number="9">                    <span class="dt">model =</span> <span class="st">&quot;RF&quot;</span>)</a>
<a class="sourceLine" id="cb184-10" data-line-number="10"></a>
<a class="sourceLine" id="cb184-11" data-line-number="11">modSVM &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">obs =</span> dat<span class="op">$</span>OCSKGM, <span class="dt">mod =</span> dat<span class="op">$</span>MKD_OCSKGM_svm, </a>
<a class="sourceLine" id="cb184-12" data-line-number="12">                     <span class="dt">model =</span> <span class="st">&quot;SVM&quot;</span>)</a>
<a class="sourceLine" id="cb184-13" data-line-number="13"></a>
<a class="sourceLine" id="cb184-14" data-line-number="14"><span class="co"># Merge the 3 data.frames into one</span></a>
<a class="sourceLine" id="cb184-15" data-line-number="15">modData &lt;-<span class="st"> </span><span class="kw">rbind</span>(modGM, modRK, modRF, modSVM)</a>
<a class="sourceLine" id="cb184-16" data-line-number="16"></a>
<a class="sourceLine" id="cb184-17" data-line-number="17"><span class="kw">summary</span>(modData)</a></code></pre></div>
<pre><code>##       obs              mod         model    
##  Min.   :0.0111   Min.   :0.0111   GM :970  
##  1st Qu.:0.6681   1st Qu.:0.8012   RK :970  
##  Median :0.9518   Median :0.9612   RF :970  
##  Mean   :1.1076   Mean   :1.0605   SVM:970  
##  3rd Qu.:1.3744   3rd Qu.:1.1894            
##  Max.   :6.1827   Max.   :5.3183            
##                   NA&#39;s   :74</code></pre>
<p><strong>Step 2 - Calculate statistical evaluation metrics</strong></p>
<p>Now we will use the <code>modStats()</code> function to calculate common numerical model evaluation statistics which are described and mathematically defined in the <strong>openair</strong> package manual <span class="citation">(Carslaw <a href="#ref-carslaw2015openair">2015</a>, Ch. 27, pp. 231-233)</span>. These include:</p>
<ul>
<li><span class="math inline">\(n\)</span>, the number of complete pairs of data;</li>
<li><span class="math inline">\(FAC2\)</span>, fraction of predictions within a factor of two;</li>
<li><span class="math inline">\(MB\)</span>, the mean bias;</li>
<li><span class="math inline">\(MGE\)</span>, the mean gross error;</li>
<li><span class="math inline">\(NMB\)</span>, the normalized mean bias;</li>
<li><span class="math inline">\(NMGE\)</span>, the normalized mean gross error;</li>
<li><span class="math inline">\(RMSE\)</span>, the root mean squared error;</li>
<li><span class="math inline">\(r\)</span>, the Pearson correlation coefficient;</li>
<li><span class="math inline">\(COE\)</span>, the Coefficient of Efficiency based on <span class="citation">Legates and McCabe (<a href="#ref-legates1999evaluating">1999</a>)</span>, <span class="citation">Legates and McCabe (<a href="#ref-legates2013refined">2013</a>)</span>. A perfect model has a <span class="math inline">\(COE\)</span> = 1. A value of <span class="math inline">\(COE\)</span> = 0 or negative implies no prediction capacity;</li>
<li><span class="math inline">\(IOA\)</span>, the Index of Agreement based on <span class="citation">Willmott, Robeson, and Matsuura (<a href="#ref-willmott2012refined">2012</a>)</span>, which spans between -1 and 1, with values approaching +1 representing better model performance.</li>
</ul>
<p>A perfect model would have a <span class="math inline">\(FAC2\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(COE\)</span> and <span class="math inline">\(IOA\)</span> ~ 1.0, while all the others ~ 0.</p>
<p>However, digital soil mappers should have in mind that there is no such thing as a perfect model on digital SOC mapping for large areas, especially if we deal with sparse data from legacy soil profile or pit observations usually collected over long periods of time. Depending on the situation, some performance measures might be more appropriate than others. Hence, there is not a single best measure, and it is necessary to use a combination of the performance measures <span class="citation">(Chang and Hanna <a href="#ref-chang2004air">2004</a>)</span>.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="kw">library</span>(openair)</a>
<a class="sourceLine" id="cb186-2" data-line-number="2"></a>
<a class="sourceLine" id="cb186-3" data-line-number="3">modsts &lt;-<span class="st"> </span><span class="kw">modStats</span>(modData,<span class="dt">obs =</span> <span class="st">&quot;obs&quot;</span>, <span class="dt">mod =</span> <span class="st">&quot;mod&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;model&quot;</span>)</a></code></pre></div>
<table>
<caption><span id="tab:modsts">Table 8.1: </span>Summary of different model evaluation statistics for the three models compared</caption>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">FAC2</th>
<th align="right">MB</th>
<th align="right">MGE</th>
<th align="right">NMB</th>
<th align="right">NMGE</th>
<th align="right">RMSE</th>
<th align="right">r</th>
<th align="right">COE</th>
<th align="right">IOA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GM</td>
<td align="right">0.80</td>
<td align="right">0.01</td>
<td align="right">0.41</td>
<td align="right">0.01</td>
<td align="right">0.37</td>
<td align="right">0.63</td>
<td align="right">0.54</td>
<td align="right">0.15</td>
<td align="right">0.57</td>
</tr>
<tr class="even">
<td align="left">RK</td>
<td align="right">0.89</td>
<td align="right">-0.08</td>
<td align="right">0.36</td>
<td align="right">-0.07</td>
<td align="right">0.32</td>
<td align="right">0.54</td>
<td align="right">0.63</td>
<td align="right">0.25</td>
<td align="right">0.63</td>
</tr>
<tr class="odd">
<td align="left">RF</td>
<td align="right">0.88</td>
<td align="right">-0.08</td>
<td align="right">0.37</td>
<td align="right">-0.07</td>
<td align="right">0.33</td>
<td align="right">0.56</td>
<td align="right">0.59</td>
<td align="right">0.23</td>
<td align="right">0.62</td>
</tr>
<tr class="even">
<td align="left">SVM</td>
<td align="right">0.86</td>
<td align="right">-0.03</td>
<td align="right">0.39</td>
<td align="right">-0.02</td>
<td align="right">0.35</td>
<td align="right">0.58</td>
<td align="right">0.53</td>
<td align="right">0.18</td>
<td align="right">0.59</td>
</tr>
</tbody>
</table>
<p>From our SOC mapping example across FYROM, the three models generate similar results. The <span class="math inline">\(FAC2\)</span> is over to 0.8 in all cases, being RK the one closer to 1. <span class="math inline">\(MB\)</span> and <span class="math inline">\(NMB\)</span> suggest that all the models tent to underestimate SOC because they are negative. SVM tend to underestimate SOC values less than RK and RF. The <span class="math inline">\(MGE\)</span>, <span class="math inline">\(NMGE\)</span>, and <span class="math inline">\(RMSE\)</span> suggest however that SVM is generating the larger error rate and by the values of <span class="math inline">\(r\)</span>, <span class="math inline">\(COE\)</span> and <span class="math inline">\(IOA\)</span>, we could say that given available SOC data across FYROM, the RK method improves the predictive capacity of RF and SVM.</p>
<p>These conclusion can be verified by plotting a Taylor Diagram (see Figure <a href="evaluation.html#fig:taylor">8.3</a>), which summarizes multiple aspects of model performance, such as the agreement and variance between observed and predicted values <span class="citation">(Taylor <a href="#ref-taylor2001summarizing">2001</a>)</span>. Recent reports show that the integration of simple validation metrics (e.g., the RMSE correlation ratio) allows to extract information about modeling performance that could not be obtained by analyzing the validation metrics independently, such as the agreement between explained variance and bias <span class="citation">(Guevara et al. <a href="#ref-guevara_2018">2018</a>; Nussbaum et al. <a href="#ref-nussbaum2018evaluation">2018</a>)</span>. Taylor Diagrams interpteration rely on the relationships between explained variance and bias (from observed and modeled data). Note from our Taylor Diagram that the RK method is closer to the observed value, followed by RF. Although, no significant difference was evident between the three implemented algorithms.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw">TaylorDiagram</span>(modData, <span class="dt">obs =</span> <span class="st">&quot;obs&quot;</span>, <span class="dt">mod =</span> <span class="st">&quot;mod&quot;</span>, <span class="dt">group =</span> <span class="st">&quot;model&quot;</span>,</a>
<a class="sourceLine" id="cb187-2" data-line-number="2"><span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="dt">cor.col=</span><span class="st">&#39;brown&#39;</span>,<span class="dt">rms.col=</span><span class="st">&#39;black&#39;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:taylor"></span>
<img src="SOCMapping_files/figure-html/taylor-1.png" alt="Taylor diagram used in the evaluation of the three selected DSM models" width="672" />
<p class="caption">
Figure 8.3: Taylor diagram used in the evaluation of the three selected DSM models
</p>
</div>
<p>However, we need also to check that the effectiveness of RK remains across all the full distribution of SOC observed values. For doing this, we can plot the conditional quantiles to verify the higher prediction capacity of RK (see Figure <a href="evaluation.html#fig:condquant">8.4</a>).</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="kw">conditionalQuantile</span>(modData,<span class="dt">obs =</span> <span class="st">&quot;obs&quot;</span>, <span class="dt">mod =</span> <span class="st">&quot;mod&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;model&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:condquant"></span>
<img src="SOCMapping_files/figure-html/condquant-1.png" alt="Effectiveness of the different DSM models across the full distribution of SOC observed values" width="672" />
<p class="caption">
Figure 8.4: Effectiveness of the different DSM models across the full distribution of SOC observed values
</p>
</div>
<p>The blue line shows the results for a perfect model. In this case, the observations cover a range from 0 to <span class="math inline">\(6 kg \cdot m^{-2}\)</span>. Interestingly, the maximum predicted value is in all cases less than <span class="math inline">\(3 kg \cdot m^{-2}\)</span>, which is consistent with the <span class="math inline">\(MB\)</span> and <span class="math inline">\(NMB\)</span> previous results. The red line shows the median value of the predictions. Note that the median of predictions across the larger SOC values seems to have more variability across SVM and RK compared with RF, which tends to be conservative across the third quantile of data distribution. The shading shows the predicted quantile intervals (i.e., the 25/75th and the 10/90th). A perfect model (blue line) would have a very narrow spread <span class="citation">(Carslaw and Ropkins <a href="#ref-openair">2012</a>)</span>. The histograms show the counts of observed (gray) and predicted values (blue). While RF shows more conservative results across the higher SOC values (e.g., over the 4th), SVM had the lowest model performance based on these metrics. SVM was also the method showing higher spatial differences compared to RF and RK.</p>
<p>We conclude, for this specific example, that RK showed the best performance based on the implemented evaluation metrics. Therefore RK is a suitable method predicting SOC values across FYROM, although other methods generate similar results, we propose that, given available data, RK could be also easier to interpret, because it provides the means to identify the main effects and coefficients of the relationships across the covariate space and the response variable. Beyond model evaluation, the spatial combination of different modeling approaches (e.g., by the means of the ensemble learning theory) should also be considered in order to maximize the accuracy of results.</p>
<p>Finally, we want to highlight that integrating different statistical methods and visualization tools, such as those provided by the <strong>openair</strong> package in <strong>R</strong> <span class="citation">(Carslaw and Ropkins <a href="#ref-openair">2012</a>)</span> will enhance our capacity to identify the best modeling approaches and a combination of SOC prediction factors given a specific dataset. Model evaluation benefits our understanding of the circumstances why each modeling approach will generate different results, which is a first step towards reducing uncertainty while increasing the spatial resolution and accuracy of predictions, the eternal problem for DSM.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ho2002simple">
<p>Ho, Yu-Chi, and David L Pepyne. 2002. “Simple Explanation of the No-Free-Lunch Theorem and Its Implications.” <em>Journal of Optimization Theory and Applications</em> 115 (3). Springer:549–70.</p>
</div>
<div id="ref-qiao2015no">
<p>Qiao, Huijie, Jorge Soberón, and Andrew Townsend Peterson. 2015. “No Silver Bullets in Correlative Ecological Niche Modelling: Insights from Testing Among Many Potential Algorithms for Niche Estimation.” <em>Methods in Ecology and Evolution</em> 6 (10). Wiley Online Library:1126–36.</p>
</div>
<div id="ref-guevara_2018">
<p>Guevara, M., G. F. Olmedo, E. Stell, Y. Yigini, Y. Aguilar Duarte, C. Arellano Hernández, G. E. Arévalo, et al. 2018. “No Silver Bullet for Digital Soil Mapping: Country-Specific Soil Organic Carbon Estimates Across Latin America.” <em>SOIL Discussions</em> 2018:1–20. <a href="https://doi.org/10.5194/soil-2017-40" class="uri">https://doi.org/10.5194/soil-2017-40</a>.</p>
</div>
<div id="ref-nussbaum2018evaluation">
<p>Nussbaum, Madlene, Kay Spiess, Andri Baltensweiler, Urs Grob, Armin Keller, Lucie Greiner, Michael E Schaepman, and Andreas Papritz. 2018. “Evaluation of Digital Soil Mapping Approaches with Large Sets of Environmental Covariates.” <em>Soil</em> 4 (1). Copernicus GmbH:1.</p>
</div>
<div id="ref-openair">
<p>Carslaw, David C., and Karl Ropkins. 2012. “Openair — an R Package for Air Quality Data Analysis.” <em>Environmental Modelling &amp; Software</em> 27–28 (0):52–61. <a href="https://doi.org/10.1016/j.envsoft.2011.09.008" class="uri">https://doi.org/10.1016/j.envsoft.2011.09.008</a>.</p>
</div>
<div id="ref-carslaw2015openair">
<p>Carslaw, DC. 2015. “The Openair Manual–Open-Source Tools for Analysing Air Pollution Data. Manual for Version 1.1–4, King’s College London.”</p>
</div>
<div id="ref-legates1999evaluating">
<p>Legates, David R, and Gregory J McCabe. 1999. “Evaluating the Use of ‘Goodness-of-Fit’ Measures in Hydrologic and Hydroclimatic Model Validation.” <em>Water Resources Research</em> 35 (1). Wiley Online Library:233–41.</p>
</div>
<div id="ref-legates2013refined">
<p>Legates, David R, and Gregory J McCabe. 2013. “A Refined Index of Model Performance: A Rejoinder.” <em>International Journal of Climatology</em> 33 (4). Wiley Online Library:1053–6.</p>
</div>
<div id="ref-willmott2012refined">
<p>Willmott, Cort J, Scott M Robeson, and Kenji Matsuura. 2012. “A Refined Index of Model Performance.” <em>International Journal of Climatology</em> 32 (13). Wiley Online Library:2088–94.</p>
</div>
<div id="ref-chang2004air">
<p>Chang, JC, and SR Hanna. 2004. “Air Quality Model Performance Evaluation.” <em>Meteorology and Atmospheric Physics</em> 87 (1-3). Springer:167–96.</p>
</div>
<div id="ref-taylor2001summarizing">
<p>Taylor, Karl E. 2001. “Summarizing Multiple Aspects of Model Performance in a Single Diagram.” <em>Journal of Geophysical Research: Atmospheres</em> 106 (D7). Wiley Online Library:7183–92.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chvalidation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="uncertainty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/08-model-evaluation.Rmd",
"text": "Edit"
},
"download": ["SOCMapping.pdf", "SOCMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
