<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Soil Organic Carbon Mapping Cookbook</title>
  <meta name="description" content="The soilll cookbook.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Soil Organic Carbon Mapping Cookbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="The soilll cookbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Soil Organic Carbon Mapping Cookbook" />
  
  <meta name="twitter:description" content="The soilll cookbook." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Food and Agriculture Organization of the United Nations, Rome, 2018">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="setting-up-the-software-environment.html">
<link rel="next" href="covariates.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>List of contributors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#editorial-board"><i class="fa fa-check"></i>Editorial board</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-authors"><i class="fa fa-check"></i>Contributing authors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>1</b> Presentation</a><ul>
<li class="chapter" data-level="1.1" data-path="presentation.html"><a href="presentation.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> How to use this book</a></li>
<li class="chapter" data-level="1.2" data-path="presentation.html"><a href="presentation.html#the-fyrom-soil-database"><i class="fa fa-check"></i><b>1.2</b> The FYROM soil database</a></li>
<li class="chapter" data-level="1.3" data-path="presentation.html"><a href="presentation.html#foreword-to-the-first-edition"><i class="fa fa-check"></i><b>1.3</b> Foreword to the first edition</a></li>
<li class="chapter" data-level="1.4" data-path="presentation.html"><a href="presentation.html#foreword-to-the-second-edition"><i class="fa fa-check"></i><b>1.4</b> Foreword to the second edition</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="soil-property-maps.html"><a href="soil-property-maps.html"><i class="fa fa-check"></i><b>2</b> Soil property maps</a><ul>
<li class="chapter" data-level="2.1" data-path="soil-property-maps.html"><a href="soil-property-maps.html#definitions-and-objectives"><i class="fa fa-check"></i><b>2.1</b> Definitions and objectives</a></li>
<li class="chapter" data-level="2.2" data-path="soil-property-maps.html"><a href="soil-property-maps.html#generic-mapping-of-soil-grids-upscaling-of-plot-level-measurements-and-estimates"><i class="fa fa-check"></i><b>2.2</b> Generic mapping of soil grids: upscaling of plot-Level measurements and estimates</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html"><i class="fa fa-check"></i><b>3</b> Setting-up the software environment</a><ul>
<li class="chapter" data-level="3.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#use-of-r-rstudio-and-r-packages"><i class="fa fa-check"></i><b>3.1</b> Use of R, RStudio and R Packages</a><ul>
<li class="chapter" data-level="3.1.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>3.1.1</b> Obtaining and installing R</a></li>
<li class="chapter" data-level="3.1.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>3.1.2</b> Obtaining and installing RStudio</a></li>
<li class="chapter" data-level="3.1.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#getting-started-with-r"><i class="fa fa-check"></i><b>3.1.3</b> Getting started with R</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#r-packages"><i class="fa fa-check"></i><b>3.2</b> R packages</a><ul>
<li class="chapter" data-level="3.2.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#finding-r-packages"><i class="fa fa-check"></i><b>3.2.1</b> Finding R packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#most-used-r-packages-for-digital-soil-mapping"><i class="fa fa-check"></i><b>3.2.2</b> Most used R packages for digital soil mapping</a></li>
<li class="chapter" data-level="3.2.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#packages-used-in-this-cookbook"><i class="fa fa-check"></i><b>3.2.3</b> Packages used in this cookbook</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#r-and-spatial-data"><i class="fa fa-check"></i><b>3.3</b> R and spatial data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#reading-shapefiles"><i class="fa fa-check"></i><b>3.3.1</b> Reading shapefiles</a></li>
<li class="chapter" data-level="3.3.2" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#coordinate-reference-systems-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Coordinate reference systems in R</a></li>
<li class="chapter" data-level="3.3.3" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#working-with-rasters"><i class="fa fa-check"></i><b>3.3.3</b> Working with rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="setting-up-the-software-environment.html"><a href="setting-up-the-software-environment.html#other-dsm-software-and-tools"><i class="fa fa-check"></i><b>3.4</b> Other DSM software and tools</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>4</b> Preparation of local soil data</a><ul>
<li class="chapter" data-level="4.1" data-path="preparation.html"><a href="preparation.html#soil-profiles-and-soil-augers"><i class="fa fa-check"></i><b>4.1</b> Soil profiles and soil augers</a></li>
<li class="chapter" data-level="4.2" data-path="preparation.html"><a href="preparation.html#soil-database"><i class="fa fa-check"></i><b>4.2</b> Soil database</a><ul>
<li class="chapter" data-level="4.2.1" data-path="preparation.html"><a href="preparation.html#type-of-soil-database"><i class="fa fa-check"></i><b>4.2.1</b> Type of soil database</a></li>
<li class="chapter" data-level="4.2.2" data-path="preparation.html"><a href="preparation.html#technical-steps-loading-soil-data-from-tables-in-r"><i class="fa fa-check"></i><b>4.2.2</b> Technical steps – Loading soil data from tables in R</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="preparation.html"><a href="preparation.html#completeness-of-measurements-and-estimates"><i class="fa fa-check"></i><b>4.3</b> Completeness of measurements and estimates</a><ul>
<li class="chapter" data-level="4.3.1" data-path="preparation.html"><a href="preparation.html#stones"><i class="fa fa-check"></i><b>4.3.1</b> Stones</a></li>
<li class="chapter" data-level="4.3.2" data-path="preparation.html"><a href="preparation.html#bulk-density"><i class="fa fa-check"></i><b>4.3.2</b> Bulk density</a></li>
<li class="chapter" data-level="4.3.3" data-path="preparation.html"><a href="preparation.html#soil-carbon-analysis"><i class="fa fa-check"></i><b>4.3.3</b> Soil carbon analysis</a></li>
<li class="chapter" data-level="4.3.4" data-path="preparation.html"><a href="preparation.html#carbonates"><i class="fa fa-check"></i><b>4.3.4</b> Carbonates</a></li>
<li class="chapter" data-level="4.3.5" data-path="preparation.html"><a href="preparation.html#depth"><i class="fa fa-check"></i><b>4.3.5</b> Depth</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="preparation.html"><a href="preparation.html#soil-depth-estimate"><i class="fa fa-check"></i><b>4.4</b> Soil depth estimate</a><ul>
<li class="chapter" data-level="4.4.1" data-path="preparation.html"><a href="preparation.html#completeness-of-depth-estimate"><i class="fa fa-check"></i><b>4.4.1</b> Completeness of depth estimate</a></li>
<li class="chapter" data-level="4.4.2" data-path="preparation.html"><a href="preparation.html#EqualAreaSplines"><i class="fa fa-check"></i><b>4.4.2</b> Technical steps - Equal-area splines using R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="covariates.html"><a href="covariates.html"><i class="fa fa-check"></i><b>5</b> Preparation of spatial covariates</a><ul>
<li class="chapter" data-level="5.1" data-path="covariates.html"><a href="covariates.html#dem-derived-covariates"><i class="fa fa-check"></i><b>5.1</b> DEM-derived covariates</a></li>
<li class="chapter" data-level="5.2" data-path="covariates.html"><a href="covariates.html#parent-material"><i class="fa fa-check"></i><b>5.2</b> Parent material</a></li>
<li class="chapter" data-level="5.3" data-path="covariates.html"><a href="covariates.html#soil-maps"><i class="fa fa-check"></i><b>5.3</b> Soil maps</a><ul>
<li class="chapter" data-level="5.3.1" data-path="covariates.html"><a href="covariates.html#global-hwsd-soil-property-maps"><i class="fa fa-check"></i><b>5.3.1</b> Global HWSD soil property maps</a></li>
<li class="chapter" data-level="5.3.2" data-path="covariates.html"><a href="covariates.html#technical-steps---rasterizing-a-vector-layer-in-r"><i class="fa fa-check"></i><b>5.3.2</b> Technical steps - Rasterizing a vector layer in R</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="covariates.html"><a href="covariates.html#land-cover-and-land-use"><i class="fa fa-check"></i><b>5.4</b> Land cover and land use</a><ul>
<li class="chapter" data-level="5.4.1" data-path="covariates.html"><a href="covariates.html#globcover-global"><i class="fa fa-check"></i><b>5.4.1</b> GlobCover (Global)</a></li>
<li class="chapter" data-level="5.4.2" data-path="covariates.html"><a href="covariates.html#landsat-geocover-global"><i class="fa fa-check"></i><b>5.4.2</b> Landsat GeoCover (Global)</a></li>
<li class="chapter" data-level="5.4.3" data-path="covariates.html"><a href="covariates.html#globeland30-global"><i class="fa fa-check"></i><b>5.4.3</b> GlobeLand30 (Global)</a></li>
<li class="chapter" data-level="5.4.4" data-path="covariates.html"><a href="covariates.html#corine-land-cover-europe-only"><i class="fa fa-check"></i><b>5.4.4</b> CORINE land cover (Europe only)</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="covariates.html"><a href="covariates.html#climate"><i class="fa fa-check"></i><b>5.5</b> Climate</a><ul>
<li class="chapter" data-level="5.5.1" data-path="covariates.html"><a href="covariates.html#worldclim-v1.4-and-v2-global"><i class="fa fa-check"></i><b>5.5.1</b> WorldClim V1.4 and V2 (Global)</a></li>
<li class="chapter" data-level="5.5.2" data-path="covariates.html"><a href="covariates.html#gridded-agro-meteorological-data-in-europe-europe"><i class="fa fa-check"></i><b>5.5.2</b> Gridded agro-meteorological data in Europe (Europe)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="covariates.html"><a href="covariates.html#GSOCDataRepo"><i class="fa fa-check"></i><b>5.6</b> GSOCMap - Data repository (ISRIC, 2017)</a><ul>
<li class="chapter" data-level="5.6.1" data-path="covariates.html"><a href="covariates.html#covariates-and-empty-mask"><i class="fa fa-check"></i><b>5.6.1</b> Covariates and empty mask</a></li>
<li class="chapter" data-level="5.6.2" data-path="covariates.html"><a href="covariates.html#data-specifications"><i class="fa fa-check"></i><b>5.6.2</b> Data specifications</a></li>
<li class="chapter" data-level="5.6.3" data-path="covariates.html"><a href="covariates.html#data-access"><i class="fa fa-check"></i><b>5.6.3</b> Data access</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="covariates.html"><a href="covariates.html#extending-the-soil-property-table-for-spatial-statistics"><i class="fa fa-check"></i><b>5.7</b> Extending the soil property table for spatial statistics</a></li>
<li class="chapter" data-level="5.8" data-path="covariates.html"><a href="covariates.html#preparation-of-a-soil-property-table-for-spatial-statistics"><i class="fa fa-check"></i><b>5.8</b> Preparation of a soil property table for spatial statistics</a></li>
<li class="chapter" data-level="5.9" data-path="covariates.html"><a href="covariates.html#overlay-soil-covariates"><i class="fa fa-check"></i><b>5.9</b> Technical steps - Overlay covariates and soil points data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mappingMethods.html"><a href="mappingMethods.html"><i class="fa fa-check"></i><b>6</b> Mapping methods</a><ul>
<li class="chapter" data-level="6.1" data-path="mappingMethods.html"><a href="mappingMethods.html#convUpscaling"><i class="fa fa-check"></i><b>6.1</b> Conventional upscaling using soil maps</a><ul>
<li class="chapter" data-level="6.1.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
<li class="chapter" data-level="6.1.2" data-path="mappingMethods.html"><a href="mappingMethods.html#diversity-of-national-soil-legacy-data-sets"><i class="fa fa-check"></i><b>6.1.2</b> Diversity of national soil legacy data sets</a></li>
<li class="chapter" data-level="6.1.3" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---class-matching"><i class="fa fa-check"></i><b>6.1.3</b> Technical steps - Class-matching</a></li>
<li class="chapter" data-level="6.1.4" data-path="mappingMethods.html"><a href="mappingMethods.html#geomQGIS"><i class="fa fa-check"></i><b>6.1.4</b> Technical steps - Geo-matching</a></li>
<li class="chapter" data-level="6.1.5" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---geo-matching-soc-with-wrb-soil-map-in-r"><i class="fa fa-check"></i><b>6.1.5</b> Technical steps - Geo-matching SOC with WRB soil map in R</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="mappingMethods.html"><a href="mappingMethods.html#RK"><i class="fa fa-check"></i><b>6.2</b> Regression-Kriging</a><ul>
<li class="chapter" data-level="6.2.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-1"><i class="fa fa-check"></i><b>6.2.1</b> Overview</a></li>
<li class="chapter" data-level="6.2.2" data-path="mappingMethods.html"><a href="mappingMethods.html#assumptions"><i class="fa fa-check"></i><b>6.2.2</b> Assumptions</a></li>
<li class="chapter" data-level="6.2.3" data-path="mappingMethods.html"><a href="mappingMethods.html#pre-processing-of-covariates"><i class="fa fa-check"></i><b>6.2.3</b> Pre-processing of covariates</a></li>
<li class="chapter" data-level="6.2.4" data-path="mappingMethods.html"><a href="mappingMethods.html#the-terminology"><i class="fa fa-check"></i><b>6.2.4</b> The terminology</a></li>
<li class="chapter" data-level="6.2.5" data-path="mappingMethods.html"><a href="mappingMethods.html#interpret-the-key-results-of-multiple-regression"><i class="fa fa-check"></i><b>6.2.5</b> Interpret the Key Results of Multiple Regression</a></li>
<li class="chapter" data-level="6.2.6" data-path="mappingMethods.html"><a href="mappingMethods.html#using-the-results-of-a-regression-analysis-to-make-predictions"><i class="fa fa-check"></i><b>6.2.6</b> Using the results of a regression analysis to make predictions</a></li>
<li class="chapter" data-level="6.2.7" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---regression-kriging"><i class="fa fa-check"></i><b>6.2.7</b> Technical steps - Regression-kriging</a></li>
<li class="chapter" data-level="6.2.8" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---cross-validation-of-regression-kriging-models"><i class="fa fa-check"></i><b>6.2.8</b> Technical steps - Cross-validation of regression-kriging models</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="mappingMethods.html"><a href="mappingMethods.html#rf"><i class="fa fa-check"></i><b>6.3</b> Data mining: random forest</a><ul>
<li class="chapter" data-level="6.3.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-2"><i class="fa fa-check"></i><b>6.3.1</b> Overview</a></li>
<li class="chapter" data-level="6.3.2" data-path="mappingMethods.html"><a href="mappingMethods.html#random-forest"><i class="fa fa-check"></i><b>6.3.2</b> Random forest</a></li>
<li class="chapter" data-level="6.3.3" data-path="mappingMethods.html"><a href="mappingMethods.html#conceptual-model-and-data-preparation"><i class="fa fa-check"></i><b>6.3.3</b> Conceptual model and data preparation</a></li>
<li class="chapter" data-level="6.3.4" data-path="mappingMethods.html"><a href="mappingMethods.html#software"><i class="fa fa-check"></i><b>6.3.4</b> Software</a></li>
<li class="chapter" data-level="6.3.5" data-path="mappingMethods.html"><a href="mappingMethods.html#tunning-random-forest-model-parameters"><i class="fa fa-check"></i><b>6.3.5</b> Tunning random forest model parameters</a></li>
<li class="chapter" data-level="6.3.6" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---random-forest"><i class="fa fa-check"></i><b>6.3.6</b> Technical steps - Random forest</a></li>
<li class="chapter" data-level="6.3.7" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---using-quantile-regression-forest-to-estimate-uncertainty"><i class="fa fa-check"></i><b>6.3.7</b> Technical steps - Using quantile regression forest to estimate uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mappingMethods.html"><a href="mappingMethods.html#svm"><i class="fa fa-check"></i><b>6.4</b> Data mining: support vector machines</a><ul>
<li class="chapter" data-level="6.4.1" data-path="mappingMethods.html"><a href="mappingMethods.html#overview-3"><i class="fa fa-check"></i><b>6.4.1</b> Overview</a></li>
<li class="chapter" data-level="6.4.2" data-path="mappingMethods.html"><a href="mappingMethods.html#technical-steps---fitting-an-svm-model-to-predict-the-soc"><i class="fa fa-check"></i><b>6.4.2</b> Technical steps - Fitting an SVM model to predict the SOC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chvalidation.html"><a href="chvalidation.html"><i class="fa fa-check"></i><b>7</b> Validation</a><ul>
<li class="chapter" data-level="7.1" data-path="chvalidation.html"><a href="chvalidation.html#what-is-validation"><i class="fa fa-check"></i><b>7.1</b> What is validation?</a></li>
<li class="chapter" data-level="7.2" data-path="chvalidation.html"><a href="chvalidation.html#QualMeasures"><i class="fa fa-check"></i><b>7.2</b> Map quality measures</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chvalidation.html"><a href="chvalidation.html#quality-measures-for-quantitative-soil-maps"><i class="fa fa-check"></i><b>7.2.1</b> Quality measures for quantitative soil maps</a></li>
<li class="chapter" data-level="7.2.2" data-path="chvalidation.html"><a href="chvalidation.html#quality-measures-for-qualitative-soil-maps"><i class="fa fa-check"></i><b>7.2.2</b> Quality measures for qualitative soil maps</a></li>
<li class="chapter" data-level="7.2.3" data-path="chvalidation.html"><a href="chvalidation.html#estimating-the-map-quality-measures-and-associated-uncertainty"><i class="fa fa-check"></i><b>7.2.3</b> Estimating the map quality measures and associated uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chvalidation.html"><a href="chvalidation.html#graphical-map-quality-measures"><i class="fa fa-check"></i><b>7.3</b> Graphical map quality measures</a></li>
<li class="chapter" data-level="7.4" data-path="chvalidation.html"><a href="chvalidation.html#validationMeth"><i class="fa fa-check"></i><b>7.4</b> Validation methods and statistical inference</a><ul>
<li class="chapter" data-level="7.4.1" data-path="chvalidation.html"><a href="chvalidation.html#addProbSampling"><i class="fa fa-check"></i><b>7.4.1</b> Additional probability sampling</a></li>
<li class="chapter" data-level="7.4.2" data-path="chvalidation.html"><a href="chvalidation.html#data-splitting"><i class="fa fa-check"></i><b>7.4.2</b> Data-splitting</a></li>
<li class="chapter" data-level="7.4.3" data-path="chvalidation.html"><a href="chvalidation.html#xval"><i class="fa fa-check"></i><b>7.4.3</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="chvalidation.html"><a href="chvalidation.html#TS:validation"><i class="fa fa-check"></i><b>7.5</b> Technical steps - Validation</a></li>
<li class="chapter" data-level="7.6" data-path="chvalidation.html"><a href="chvalidation.html#dataSplit"><i class="fa fa-check"></i><b>7.6</b> Technical steps - Data-splitting</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>8</b> Model evaluation in digital soil mapping</a><ul>
<li class="chapter" data-level="8.1" data-path="evaluation.html"><a href="evaluation.html#technical-steps---model-correlations-and-spatial-differences"><i class="fa fa-check"></i><b>8.1</b> Technical steps - Model correlations and spatial differences</a></li>
<li class="chapter" data-level="8.2" data-path="evaluation.html"><a href="evaluation.html#technical-steps---model-evaluation"><i class="fa fa-check"></i><b>8.2</b> Technical steps - Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>9</b> Uncertainty</a><ul>
<li class="chapter" data-level="9.1" data-path="uncertainty.html"><a href="uncertainty.html#sourcesuncert"><i class="fa fa-check"></i><b>9.1</b> Sources of uncertainty</a><ul>
<li class="chapter" data-level="9.1.1" data-path="uncertainty.html"><a href="uncertainty.html#attribute-uncertainty-of-soil-measurements"><i class="fa fa-check"></i><b>9.1.1</b> Attribute uncertainty of soil measurements</a></li>
<li class="chapter" data-level="9.1.2" data-path="uncertainty.html"><a href="uncertainty.html#positional-uncertainty-of-soil-measurements"><i class="fa fa-check"></i><b>9.1.2</b> Positional uncertainty of soil measurements</a></li>
<li class="chapter" data-level="9.1.3" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-in-covariates"><i class="fa fa-check"></i><b>9.1.3</b> Uncertainty in covariates</a></li>
<li class="chapter" data-level="9.1.4" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-in-models-predicting-soil-properties-from-covariates-and-soil-point-data"><i class="fa fa-check"></i><b>9.1.4</b> Uncertainty in models predicting soil properties from covariates and soil point data</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-and-spatial-data-quality"><i class="fa fa-check"></i><b>9.2</b> Uncertainty and spatial data quality</a></li>
<li class="chapter" data-level="9.3" data-path="uncertainty.html"><a href="uncertainty.html#quantifying-prediction-uncertainty"><i class="fa fa-check"></i><b>9.3</b> Quantifying prediction uncertainty</a><ul>
<li class="chapter" data-level="9.3.1" data-path="uncertainty.html"><a href="uncertainty.html#uncertainty-characterised-by-probability-distributions"><i class="fa fa-check"></i><b>9.3.1</b> Uncertainty characterised by probability distributions</a></li>
<li class="chapter" data-level="9.3.2" data-path="uncertainty.html"><a href="uncertainty.html#propagation-of-model-uncertainty"><i class="fa fa-check"></i><b>9.3.2</b> Propagation of model uncertainty</a></li>
<li class="chapter" data-level="9.3.3" data-path="uncertainty.html"><a href="uncertainty.html#propUncertainty"><i class="fa fa-check"></i><b>9.3.3</b> Propagation of attribute, positional and covariate uncertainty</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-sharing.html"><a href="data-sharing.html"><i class="fa fa-check"></i><b>10</b> Data sharing</a><ul>
<li class="chapter" data-level="10.1" data-path="data-sharing.html"><a href="data-sharing.html#export-formats"><i class="fa fa-check"></i><b>10.1</b> Export formats</a><ul>
<li class="chapter" data-level="10.1.1" data-path="data-sharing.html"><a href="data-sharing.html#type-of-soil-data-and-their-formatting"><i class="fa fa-check"></i><b>10.1.1</b> Type of soil data and their formatting</a></li>
<li class="chapter" data-level="10.1.2" data-path="data-sharing.html"><a href="data-sharing.html#general-gis-data-formats-vector-raster-table"><i class="fa fa-check"></i><b>10.1.2</b> General GIS data formats: vector, raster, table</a></li>
<li class="chapter" data-level="10.1.3" data-path="data-sharing.html"><a href="data-sharing.html#recommended-gis-data-exchange-formats"><i class="fa fa-check"></i><b>10.1.3</b> Recommended GIS data exchange formats</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="data-sharing.html"><a href="data-sharing.html#webService"><i class="fa fa-check"></i><b>10.2</b> Web services: serving soil data using web technology</a><ul>
<li class="chapter" data-level="10.2.1" data-path="data-sharing.html"><a href="data-sharing.html#third-party-services"><i class="fa fa-check"></i><b>10.2.1</b> Third-party services</a></li>
<li class="chapter" data-level="10.2.2" data-path="data-sharing.html"><a href="data-sharing.html#geoserver-web-serving-and-web-processing"><i class="fa fa-check"></i><b>10.2.2</b> GeoServer (web serving and web processing)</a></li>
<li class="chapter" data-level="10.2.3" data-path="data-sharing.html"><a href="data-sharing.html#visualizing-data-using-leaflet-andor-google-earth"><i class="fa fa-check"></i><b>10.2.3</b> Visualizing data using Leaflet and/or Google Earth</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="data-sharing.html"><a href="data-sharing.html#preparing-soil-data-for-distribution"><i class="fa fa-check"></i><b>10.3</b> Preparing soil data for distribution</a><ul>
<li class="chapter" data-level="10.3.1" data-path="data-sharing.html"><a href="data-sharing.html#metadata"><i class="fa fa-check"></i><b>10.3.1</b> Metadata</a></li>
<li class="chapter" data-level="10.3.2" data-path="data-sharing.html"><a href="data-sharing.html#exporting-data-final-tips"><i class="fa fa-check"></i><b>10.3.2</b> Exporting data: final tips</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="data-sharing.html"><a href="data-sharing.html#export-formats-1"><i class="fa fa-check"></i><b>10.4</b> Export formats</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html"><i class="fa fa-check"></i><b>11</b> Technical overview and the checklist</a><ul>
<li class="chapter" data-level="11.1" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#point-dataset"><i class="fa fa-check"></i><b>11.1</b> Point dataset</a></li>
<li class="chapter" data-level="11.2" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#covariates-1"><i class="fa fa-check"></i><b>11.2</b> Covariates</a></li>
<li class="chapter" data-level="11.3" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#statistical-inference"><i class="fa fa-check"></i><b>11.3</b> Statistical inference</a></li>
<li class="chapter" data-level="11.4" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#spatial-interpolation"><i class="fa fa-check"></i><b>11.4</b> Spatial interpolation</a></li>
<li class="chapter" data-level="11.5" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#calculation-of-stocks"><i class="fa fa-check"></i><b>11.5</b> Calculation of stocks</a></li>
<li class="chapter" data-level="11.6" data-path="technical-overview-and-the-checklist.html"><a href="technical-overview-and-the-checklist.html#evaluation-of-output-and-quality-assessment"><i class="fa fa-check"></i><b>11.6</b> Evaluation of output and quality assessment</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="compendium.html"><a href="compendium.html"><i class="fa fa-check"></i><b>12</b> Compendium of the code examples</a><ul>
<li class="chapter" data-level="12.1" data-path="compendium.html"><a href="compendium.html#cd:PreparationProfiles"><i class="fa fa-check"></i><b>12.1</b> Data preparation for soil profiles</a></li>
<li class="chapter" data-level="12.2" data-path="compendium.html"><a href="compendium.html#cd:PreparationAuger"><i class="fa fa-check"></i><b>12.2</b> Data preparation for topsoil or auger samples</a></li>
<li class="chapter" data-level="12.3" data-path="compendium.html"><a href="compendium.html#cd:merging"><i class="fa fa-check"></i><b>12.3</b> Merging topsoil or auger samples and soil profiles databases</a></li>
<li class="chapter" data-level="12.4" data-path="compendium.html"><a href="compendium.html#cd:data-splitting"><i class="fa fa-check"></i><b>12.4</b> Data-splitting</a></li>
<li class="chapter" data-level="12.5" data-path="compendium.html"><a href="compendium.html#cd:Rasterizing"><i class="fa fa-check"></i><b>12.5</b> Rasterizing a vector layer in R</a></li>
<li class="chapter" data-level="12.6" data-path="compendium.html"><a href="compendium.html#cd:Overlay"><i class="fa fa-check"></i><b>12.6</b> Overlay covariates and soil points data</a></li>
<li class="chapter" data-level="12.7" data-path="compendium.html"><a href="compendium.html#cd:RK"><i class="fa fa-check"></i><b>12.7</b> Fitting a regression-kriging model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.8" data-path="compendium.html"><a href="compendium.html#cd:xvalRK"><i class="fa fa-check"></i><b>12.8</b> Cross-validation of regression-kriging models</a></li>
<li class="chapter" data-level="12.9" data-path="compendium.html"><a href="compendium.html#cd:rf"><i class="fa fa-check"></i><b>12.9</b> Fitting a random forest model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.10" data-path="compendium.html"><a href="compendium.html#cd:quantreg"><i class="fa fa-check"></i><b>12.10</b> Using quantile regression forest to estimate uncertainty</a></li>
<li class="chapter" data-level="12.11" data-path="compendium.html"><a href="compendium.html#cd:svm"><i class="fa fa-check"></i><b>12.11</b> Fitting a support vector machines model to predict the SOC stock</a></li>
<li class="chapter" data-level="12.12" data-path="compendium.html"><a href="compendium.html#cd:Validation"><i class="fa fa-check"></i><b>12.12</b> Validation</a></li>
<li class="chapter" data-level="12.13" data-path="compendium.html"><a href="compendium.html#cd:Graphs"><i class="fa fa-check"></i><b>12.13</b> Graphical map quality measures</a></li>
<li class="chapter" data-level="12.14" data-path="compendium.html"><a href="compendium.html#cd:Evaluation"><i class="fa fa-check"></i><b>12.14</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Soil Organic Carbon Mapping Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preparation" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Preparation of local soil data</h1>
<p><em>G.F. Olmedo &amp; R. Baritz</em></p>
<p>The authors of this Chapter used <strong>R</strong> packages. To run the code provided in this Chapter, the following packages need to be installed in the <strong>R</strong> user library. If the packages are not yet installed, the <code>install.packages()</code> function can be used.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># Installing packages for Chapter &#39;Preparation of Local Soil Data&#39;</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;aqp&quot;</span>, <span class="st">&quot;GSIF&quot;</span>))</a></code></pre></div>
<div id="soil-profiles-and-soil-augers" class="section level2">
<h2><span class="header-section-number">4.1</span> Soil profiles and soil augers</h2>
<p>Soil profiles are complex real-world entities. They are composed of soil layers which form soil horizons; the soil layers have different properties and these properties are evaluated with different methods. As we know, soil and vertical soil properties are landscape elements and part of matter dynamics (water, nutrients, gases, habitat, etc.). Local soil samples or soil profiles add a third dimension into the spatial assessment of soil properties in the landscape.</p>
<p>Most commonly, soils are described as vertical profiles using soil pits (sometimes also augerings, but this is less accurate). Soil profiles are described using macro-morphological properties. These properties can be assessed in the field without analysis by making a field inventory or land evaluation. For additional quantitative analysis, soils are then sampled by genetic horizons or by depth class.</p>
<p>The sampling of soils is the basis to obtain quantitative information. Depending on the goal of a project, sampling can be quite diverse. Sampling can follow the description of the soil or can be conducted without, for example using a spade or auger to generate a composite sample for a certain depth independent of the morphological features such as soil horizons.
Sampling locations can be representative of a certain location, project, field, or mapped object, such as a soil type.</p>
</div>
<div id="soil-database" class="section level2">
<h2><span class="header-section-number">4.2</span> Soil database</h2>
<div id="type-of-soil-database" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Type of soil database</h3>
<p>In order to process and evaluate soil information from field assessments, soil profile data and analytical information need to be stored in a database. This can be a set of simple Microsoft Office <em>Excel</em> spreadsheets, or a relational or object-oriented database management system <span class="citation">(Baritz et al. <a href="#ref-baritz2008environmental">2008</a>)</span>. When working in <strong>R</strong>, <code>SoilProfileCollections</code> (SPC) from the <strong>R</strong> <strong>aqp</strong> package are a useful tool. Tables <a href="preparation.html#tab:site-level">4.1</a> and <a href="preparation.html#tab:horizon-level">4.2</a> are examples of how soil information can be stored. The advantage of such organization is the possibility to develop relational databases which can be easily queried. Such a systematic approach will support the organization of national soil information and will reduce errors in future modeling exercises <span class="citation">(Baritz et al. <a href="#ref-baritz2008environmental">2008</a>)</span>.</p>
<p>Table <a href="preparation.html#tab:site-level">4.1</a> stores site-level data, which describe the location of the soil description and/or sampling site: spatial coordinates, landscape attributes such as slope gradient and slope form, soil class, land cover type, rock type, etc. In this table, every row should hold a single soil profile. One column, usually the first one, should be the soil profile’s unique identifier. Using the latter, soil information can be easily linked from one table to another.</p>
<table>
<caption><span id="tab:site-level">Table 4.1: </span>Example for site-level data table</caption>
<thead>
<tr class="header">
<th align="left">ProfID</th>
<th align="right">X_coord</th>
<th align="right">Y_coord</th>
<th align="right">Year</th>
<th align="left">Soil_Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">P1276</td>
<td align="right">7591265</td>
<td align="right">4632108</td>
<td align="right">2012</td>
<td align="left">Complex of Chernozem …</td>
</tr>
<tr class="even">
<td align="left">P1277</td>
<td align="right">7592027</td>
<td align="right">4631664</td>
<td align="right">2012</td>
<td align="left">Complex of Chernozem …</td>
</tr>
<tr class="odd">
<td align="left">P1278</td>
<td align="right">7592704</td>
<td align="right">4631941</td>
<td align="right">2012</td>
<td align="left">Complex of Chernozem …</td>
</tr>
<tr class="even">
<td align="left">P1279</td>
<td align="right">7590817</td>
<td align="right">4633115</td>
<td align="right">2013</td>
<td align="left">Complex of Chernozem …</td>
</tr>
</tbody>
</table>
<p>Table <a href="preparation.html#tab:horizon-level">4.2</a> stores information from the soil description, such as horizon name, horizon thickness, organic matter content, carbonate content, soil color, laboratory soil analysis, etc. The first column contains the soil profile’s unique identifier. It is important to include the upper and lower limits for each soil layer; in case the sampling strategy deviates from soil layers/soil horizons, the upper and lower depth of the sampling locations should be specified if possible. This information is needed for modeling soil properties over the soil profile.</p>
<table>
<caption><span id="tab:horizon-level">Table 4.2: </span>Example for profile-description table</caption>
<thead>
<tr class="header">
<th align="left">ProfID</th>
<th align="left">HorID</th>
<th align="right">top</th>
<th align="right">bottom</th>
<th align="right">SOC</th>
<th align="right">BLD</th>
<th align="right">CRF</th>
<th align="right">Sand</th>
<th align="right">Silt</th>
<th align="right">Clay</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">P1276</td>
<td align="left">P1276H01</td>
<td align="right">0</td>
<td align="right">50</td>
<td align="right">2.78</td>
<td align="right">1.05</td>
<td align="right">11</td>
<td align="right">52</td>
<td align="right">39</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">P1276</td>
<td align="left">P1276H02</td>
<td align="right">50</td>
<td align="right">76</td>
<td align="right">1.75</td>
<td align="right">1.45</td>
<td align="right">4</td>
<td align="right">56</td>
<td align="right">31</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">P1276</td>
<td align="left">P1276H03</td>
<td align="right">76</td>
<td align="right">100</td>
<td align="right">1.19</td>
<td align="right">1.22</td>
<td align="right">2</td>
<td align="right">43</td>
<td align="right">35</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="left">P1277</td>
<td align="left">P1277H01</td>
<td align="right">0</td>
<td align="right">28</td>
<td align="right">1.93</td>
<td align="right">1.36</td>
<td align="right">8</td>
<td align="right">59</td>
<td align="right">22</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">P1277</td>
<td align="left">P1277H02</td>
<td align="right">28</td>
<td align="right">48</td>
<td align="right">1.60</td>
<td align="right">1.43</td>
<td align="right">9</td>
<td align="right">69</td>
<td align="right">15</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">P1277</td>
<td align="left">P1277H03</td>
<td align="right">48</td>
<td align="right">63</td>
<td align="right">1.26</td>
<td align="right">NA</td>
<td align="right">25</td>
<td align="right">65</td>
<td align="right">21</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">P1277</td>
<td align="left">P1277H04</td>
<td align="right">63</td>
<td align="right">120</td>
<td align="right">0.86</td>
<td align="right">NA</td>
<td align="right">54</td>
<td align="right">63</td>
<td align="right">23</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">P1278</td>
<td align="left">P1278H01</td>
<td align="right">0</td>
<td align="right">40</td>
<td align="right">2.32</td>
<td align="right">1.27</td>
<td align="right">0</td>
<td align="right">50</td>
<td align="right">39</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">P1278</td>
<td align="left">P1278H02</td>
<td align="right">40</td>
<td align="right">68</td>
<td align="right">1.80</td>
<td align="right">1.48</td>
<td align="right">1</td>
<td align="right">46</td>
<td align="right">39</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">P1278</td>
<td align="left">P1278H03</td>
<td align="right">68</td>
<td align="right">120</td>
<td align="right">0.89</td>
<td align="right">1.18</td>
<td align="right">0</td>
<td align="right">47</td>
<td align="right">39</td>
<td align="right">14</td>
</tr>
</tbody>
</table>
</div>
<div id="technical-steps-loading-soil-data-from-tables-in-r" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Technical steps – Loading soil data from tables in R</h3>
<p>This Chapter includes two examples for soil data preparation. As each step for the soil data preparation is explained in detail, the given code is mixed with text. A copy of the bare code is presented in Section <a href="compendium.html#cd:PreparationProfiles">12.1</a> for using soil profiles data, and for using topsoil or auger data the code can be found in Section <a href="compendium.html#cd:PreparationAuger">12.2</a>.</p>
<p><strong>Option 1 - Soil profiles data</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;data/horizons.csv&quot;</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co"># Explore the data</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">str</span>(dat)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="kw">summary</span>(dat)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10292 obs. of  10 variables:
##  $ ProfID: Factor w/ 4118 levels &quot;P0000&quot;,&quot;P0001&quot;,..: 1 1 1 2 2 ..
##  $ HorID : Factor w/ 9914 levels &quot;P0000H01&quot;,&quot;P0000H02&quot;,..: 1 2 ..
##  $ top   : int  4 23 46 2 11 0 22 63 0 3 ...
##  $ bottom: int  23 46 59 11 31 22 63 90 19 10 ...
##  $ SOC   : num  NA NA NA NA NA ...
##  $ BLD   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CRF   : num  54 62 47 66 70 57 77 87 8 4 ...
##  $ SAND  : int  52 59 67 45 40 52 48 43 50 48 ...
##  $ SILT  : num  34 31 24 39 31 33 36 42 16 35 ...
##  $ CLAY  : num  14 11 8 16 28 15 16 16 34 17 ...
##      ProfID           HorID            top        
##  P2881  :   64   P2881H01:   64   Min.   :  0.00  
##  P1481  :   32   P0434H02:    8   1st Qu.:  0.00  
##  P2096  :   32   P1286H01:    8   Median : 20.00  
##  P3623  :   32   P2056H01:    8   Mean   : 27.48  
##  P2056  :   24   P2056H02:    8   3rd Qu.: 47.00  
##  P2142  :   24   P2056H03:    8   Max.   :285.00  
##  (Other):10084   (Other) :10188                   
##      bottom            SOC              BLD      
##  Min.   :  1.00   Min.   : 0.000   Min.   :0.00  
##  1st Qu.: 25.00   1st Qu.: 1.090   1st Qu.:1.40  
##  Median : 45.00   Median : 1.800   Median :1.54  
##  Mean   : 55.82   Mean   : 2.603   Mean   :1.55  
##  3rd Qu.: 80.00   3rd Qu.: 2.940   3rd Qu.:1.66  
##  Max.   :295.00   Max.   :83.820   Max.   :2.93  
##                   NA&#39;s   :831      NA&#39;s   :7845  
##       CRF             SAND             SILT      
##  Min.   :  0.0   Min.   :  0.00   Min.   : 0.00  
##  1st Qu.:  2.0   1st Qu.: 44.00   1st Qu.:16.00  
##  Median :  8.0   Median : 58.00   Median :24.00  
##  Mean   : 13.5   Mean   : 57.67   Mean   :25.64  
##  3rd Qu.: 21.0   3rd Qu.: 72.00   3rd Qu.:33.00  
##  Max.   :104.0   Max.   :100.00   Max.   :80.00  
##  NA&#39;s   :3360    NA&#39;s   :1049     NA&#39;s   :920    
##       CLAY      
##  Min.   : 0.00  
##  1st Qu.: 7.00  
##  Median :14.00  
##  Mean   :17.08  
##  3rd Qu.:24.00  
##  Max.   :83.00  
##  NA&#39;s   :927</code></pre>
<p><strong>Option 2 - Topsoil or auger data</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">dat_sites &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;data/site-level.csv&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co"># Explore the data</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">str</span>(dat_sites)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4118 obs. of  6 variables:
##  $ X.1       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ ProfID    : Factor w/ 4118 levels &quot;P0000&quot;,&quot;P0001&quot;,..: 1 2 3 ..
##  $ soiltype  : Factor w/ 58 levels &quot;Albic Luvisol&quot;,..: 3 3 3 57..
##  $ Land.Cover: int  25 24 25 26 26 27 27 27 22 23 ...
##  $ X         : num  20.8 20.8 20.8 20.8 20.8 ...
##  $ Y         : num  42 42 42 42 42 ...</code></pre>
</div>
</div>
<div id="completeness-of-measurements-and-estimates" class="section level2">
<h2><span class="header-section-number">4.3</span> Completeness of measurements and estimates</h2>
<p>The <a href="http://www.fao.org/3/a-bp164e.pdf"><em>GSP Guidelines for Sharing National Data/Information to Compile a Global Soil Organic Carbon (GSOC) Map</em></a> <span class="citation">(FAO and GSP <a href="#ref-gsp_guidelines_2017">2017</a><a href="#ref-gsp_guidelines_2017">a</a>)</span> specify which soil parameters are needed to produce a GSOCmap. Of course, other soil properties can be evaluated and modeled using this cookbook as well.</p>
<p>SOC stocks for soil horizons or targeted soil depths can be calculated using the equations in Section 8.4.3 of the <a href="http://www.fao.org/3/a-bp164e.pdf"><em>GSP Guidelines for Sharing National Data/Information to Compile a Global Soil Organic Carbon (GSOC) Map</em></a>. Carbon concentration, bulk density and stone content for a certain depth or genetic horizon are needed to calculate the amount of carbon stored in that depth interval/soil horizon. In many countries, legacy data from former surveys and projects, as well as from various owners and data sources are compiled. Often, measured bulk densities are either missing, only available for few soil profiles, or are estimated. Stones in the soil profile are usually only estimated, and if augers are used for sampling, stone content is not assessed at all. Pedo-transfer functions (PTFs) can be used to fill data gaps (e.g. bulk density), and interpolation approaches can be used to infer from measured depths to target depths.</p>
<div id="stones" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Stones</h3>
<p>The estimation of stoniness is difficult and time-consuming, and therefore not carried out in many national soil inventories, or only estimated visually in the profile. Unfortunately, if soil inventories and sampling are done with simple pits or augers rather than standard soil pits, stones are very often not assessed.</p>
<p>As a proxy, it is recommended to derive national default values from well-described soil profile pits by soil type.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Summary of column CRF (coarse fragments) in the example data base</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">summary</span>(dat<span class="op">$</span>CRF)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##     0.0     2.0     8.0    13.5    21.0   104.0    3360</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Convert NA&#39;s to 0</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">dat<span class="op">$</span>CRF[<span class="kw">is.na</span>(dat<span class="op">$</span>CRF)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="kw">hist</span>(dat<span class="op">$</span>CRF, <span class="dt">col =</span> <span class="st">&quot;light gray&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="SOCMapping_files/figure-html/unnamed-chunk-10-1.png" alt="Histogram of coarse fragments values" width="672" />
<p class="caption">
Figure 4.1: Histogram of coarse fragments values
</p>
</div>
</div>
<div id="bulk-density" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Bulk density</h3>
<p>The amount of fine earth is one of the basic estimation parameters to estimate SOC stocks in the mineral soil as well as in peat layers. It depends on the volume of soil considered (<span class="math inline">\(\text{depth} \times \text{reference area}\)</span>) and the bulk density (BD). BD expresses the soil weight per unit volume. When determining the BD, it is important to subtract stones, if any, from the cylinder samples; if this is not done, BD is underestimated, and the resulting SOC stocks are overestimated. Stones in the cylinders are added to the total stone content in order to correct for the total amount of fine earth per volume of soil in a given area.</p>
<p>Most of the soil profiles in national databases come from agricultural land. Very often, BD estimates do not consider fine stones because top soils (e.g. plough layers) seem to be free of visible stones.</p>
<p><strong>Mineral soil</strong>: Default values from the <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/office/ssr10/tr/?cid=nrcs144p2_074844"><em>General Guide for Estimating Moist Bulk Density</em></a> given by <span class="citation">Agriculture. Soil Conservation Service (<a href="#ref-USDA_2018">2018</a>)</span>. If analytical BD is missing, BD can be estimated using pedo-transfer functions (see examples listed below).</p>
<p>For organic soil material, <span class="math inline">\(BD_x\)</span> can be estimated as follows, considering existing litter layers <span class="math inline">\(L\)</span> (or Oi horizon); organic or duff layers, partially decomposed material above the mineral soil and beneath the litter layer; fermentation horizons <span class="math inline">\(F\)</span>;humus horizons <span class="math inline">\(H\)</span> (or Oe and Oa horizons); and peat layers <span class="math inline">\(P\)</span>, as described in the <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_051232.pdf"><em>U.S. Soil Taxonomy</em></a> <span class="citation">(Agriculture. Soil Conservation Service <a href="#ref-united1975soil">1975</a>)</span>.</p>
<p><strong>Forest floor</strong>: Default values from <span class="citation">Barney et al. (<a href="#ref-barney_forest_1981">1981</a>)</span> and <span class="citation">Ottmar and Andreu (<a href="#ref-ottmar_litter_2007">2007</a>)</span>:</p>
<ul>
<li><p>Pine: <span class="math inline">\(BD_{L} = 0.018 g \cdot cm^{-3}\)</span>; <span class="math inline">\(BD_{F,H} = 0.057 g \cdot cm^{-3}\)</span></p></li>
<li><p>Hardwood: <span class="math inline">\(BD_{L} = 0.012 g \cdot cm^{-3}\)</span></p></li>
<li><p>Birch: <span class="math inline">\(BD_{F,H} = 0.17 g \cdot cm^{-3}\)</span></p></li>
<li><p>Spruce: <span class="math inline">\(BD_{L} = 0.051 g \cdot cm^{-3}\)</span>; <span class="math inline">\(BD_{H}= 0.13 g \cdot cm^{-3}\)</span></p></li>
</ul>
<p><strong>Peat</strong>: Default value: <span class="math inline">\(BD_{P} = 0.31 g \cdot cm^{-3}\)</span> <span class="citation">(<span class="citeproc-not-found" data-reference-id="batjes1996"><strong>???</strong></span>)</span>. The range of peat BD is generally from 0.02 to 0.3<span class="math inline">\(t \cdot m^{-3}\)</span> depending on maturity and compaction, as well as the ash content <span class="citation">(Agus, Hairiah, and Mulyani <a href="#ref-agus_measuring_2011">2011</a>)</span>. total and <span class="citation">Agus, Hairiah, and Mulyani (<a href="#ref-agus_measuring_2011">2011</a>)</span> distinguish different peat decomposition types with different C content:</p>
<ul>
<li><p>Sapric: <span class="math inline">\(BD_{P,\text{sapric}} = 0.174 g \cdot cm^{-3}\)</span> (<span class="math inline">\(48.90\%\)</span> C)</p></li>
<li><p>Hemic: <span class="math inline">\(BD_{P,\text{hemic}} = 0.117 g \cdot cm^{-3}\)</span> (<span class="math inline">\(52.27\%\)</span> C)</p></li>
<li><p>Fibric: <span class="math inline">\(BD_{P,\text{fibric}} = 0.089 g \cdot cm^{-3}\)</span> (<span class="math inline">\(53.56\%\)</span> C)</p></li>
</ul>
<p>Example equations for PTFs to estimate <span class="math inline">\(BD\)</span>, based on the soil organic matter (SOM) (<span class="math inline">\(OM\)</span>) content in percent (%):</p>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 1.62-0.06 * OM
\end{equation}\]</span>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 1/(0.6268 + 0.0361 * OM)
\end{equation}\]</span>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 1.482 - 0.6786 * (log OM)
\end{equation}\]</span>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 0.669 + 0.941 * e^{(-0,06 * OM)}
\end{equation}\]</span>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 100/(OM/0.244 + (100-OM))/MBD
\end{equation}\]</span>
<p>:</p>
<span class="math display">\[\begin{equation}
BD = 1/(0.564 + 0.0556*OM)
\end{equation}\]</span>
<p>where <span class="math inline">\(MDB\)</span> is the mineral particle density, assumed to be the specific gravity of quartz, <span class="math inline">\(2.65 Mg \cdot m^{-3}\)</span>. And <span class="math inline">\(OM\)</span> is the SOM content, estimated as <span class="math inline">\(OM = SOC \cdot 1.724\)</span>, with <span class="math inline">\(SOC\)</span> content in percent (%).</p>
<p>Each method to estimate the BD presented in is derived from a specific set of regional soils that is regionally adapted. Selection of the proper method for a given country shall be based on existing reviews and comparisons.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Creating a function in R to estimate BLD using the SOC</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co"># SOC is the soil organic carbon content in percent %</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">estimateBD &lt;-<span class="st"> </span><span class="cf">function</span>(SOC, <span class="dt">method=</span><span class="st">&quot;Saini1996&quot;</span>){</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  OM &lt;-<span class="st"> </span>SOC <span class="op">*</span><span class="st"> </span><span class="fl">1.724</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Saini1996&quot;</span>){BD &lt;-<span class="st"> </span><span class="fl">1.62</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.06</span> <span class="op">*</span><span class="st"> </span>OM}</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Drew1973&quot;</span>){BD &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="fl">0.6268</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.0361</span> <span class="op">*</span><span class="st"> </span>OM)}</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Jeffrey1979&quot;</span>){BD &lt;-<span class="st"> </span><span class="fl">1.482</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.6786</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">log</span>(OM))}</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Grigal1989&quot;</span>){BD &lt;-<span class="st"> </span><span class="fl">0.669</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.941</span> <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="dv">1</span>)<span class="op">^</span>(<span class="op">-</span><span class="fl">0.06</span> <span class="op">*</span><span class="st"> </span>OM)}</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Adams1973&quot;</span>){BD &lt;-<span class="st"> </span><span class="dv">100</span> <span class="op">/</span><span class="st"> </span>(OM <span class="op">/</span><span class="fl">0.244</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">100</span> <span class="op">-</span><span class="st"> </span>OM)<span class="op">/</span><span class="fl">2.65</span>)}</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">  <span class="cf">if</span>(method<span class="op">==</span><span class="st">&quot;Honeyset_Ratkowsky1989&quot;</span>){BD &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(<span class="fl">0.564</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.0556</span> <span class="op">*</span><span class="st"> </span>OM)}</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">  <span class="kw">return</span>(BD)</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">}</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># Summary of BLD (bulk density) in the example data base</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">summary</span>(dat<span class="op">$</span>BLD)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    0.00    1.40    1.54    1.55    1.66    2.93    7845</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># See the summary of values produced using the pedo-transfer </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co"># function with one of the proposed methods</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw">summary</span>(<span class="kw">estimateBD</span>(dat<span class="op">$</span>SOC[<span class="kw">is.na</span>(dat<span class="op">$</span>BLD)], </a>
<a class="sourceLine" id="cb24-4" data-line-number="4">                   <span class="dt">method=</span><span class="st">&quot;Honeyset_Ratkowsky1989&quot;</span>))</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##  0.2019  1.1599  1.3498  1.2974  1.4981  1.7730     729</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Fill NA&#39;s using the pedo-transfer function</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">dat<span class="op">$</span>BLD[<span class="kw">is.na</span>(dat<span class="op">$</span>BLD)] &lt;-<span class="st"> </span><span class="kw">estimateBD</span>(dat<span class="op">$</span>SOC[<span class="kw">is.na</span>(dat<span class="op">$</span>BLD)], </a>
<a class="sourceLine" id="cb26-3" data-line-number="3">                                      <span class="dt">method=</span><span class="st">&quot;Grigal1989&quot;</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co"># Explore the results</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="kw">hist</span>(dat<span class="op">$</span>BLD, <span class="dt">col =</span> <span class="st">&#39;light gray&#39;</span>, <span class="dt">breaks =</span> <span class="dv">32</span>)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="SOCMapping_files/figure-html/unnamed-chunk-12-1.png" alt="Histogram of bulk density values" width="672" />
<p class="caption">
Figure 4.2: Histogram of bulk density values
</p>
</div>
</div>
<div id="soil-carbon-analysis" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Soil carbon analysis</h3>
<p> have closely reviewed the different SOC and SOM estimation procedures, and have also drawn some conclusions about the sources of errors. Determination of SOC from dry combustion methods is least susceptible to errors.</p>
<ul>
<li><p><strong>Dry combustion by Loss on Ignition (LOI)</strong>: SOC is re-calculated applying a conversion factor. It is commonly assumed, that organic matter contains an average of 58% organic carbon (so-called Van Bemmelen factor 1.724; for non-organic horizons: <span class="math inline">\(SOC = SOM / 1.724\)</span>). For organic horizons, conversion factor ranges from 1.9 to 2.5 . The inorganic carbon is not resolved, since typically, temperatures between 400°C and 550°C are used.</p></li>
<li><p><strong>Wet oxidation</strong>: Since wet oxidation is applied without additional (external) heating, low temperatures of around 120°C (internal heat) are typical. Thus, the oxidation of carbon is incomplete, and a so-called oxidation factor needs to be applied. With external heating, the C-recovery of the method becomes improved, up to complete recovery. No correction of the mineral carbon is needed. Wet oxidation should typically only be applied to samples with &lt;5% organic matter.</p></li>
</ul>
<p>Usually, an average of 76% organic carbon is recovered, leading to a standard oxidation factor of 1.33 .</p>
</div>
<div id="carbonates" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Carbonates</h3>
<p>In case the total organic carbon is determined with temperatures higher than 600°C to 800°C, the proportion of mineral soil in <span class="math inline">\(CaCO_3\)</span> has to be subtracted in order to derive the amount of organic carbon (inorganic carbon is also oxidized). The pH value gives the first indication whether the sample has to be analyzed for inorganic carbon or not.</p>
<p>It is crucial to report in the metadata whether national SOC values refer to total C or if the inorganic component has been considered.</p>
</div>
<div id="depth" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Depth</h3>
<p>The standard depth for GSOCmap is <strong>0 cm to 30 cm</strong> <span class="citation">(FAO and GSP <a href="#ref-gsp_guidelines_2017">2017</a><a href="#ref-gsp_guidelines_2017">a</a>)</span>. Subdivisions are possible depending on the available data, by genetic horizons or depth classes. The following depths are additionally considered for GSOCmap (optional):</p>
<ul>
<li><p><strong>Forest floor</strong>: Thickness (cm) subdivision in horizons depending on national soil inventory method (e.g. for forest floors organic layers L, F, H).</p></li>
<li><p><strong>Peat</strong>: From 30cm to 100cm, depending on national data.</p></li>
</ul>
</div>
</div>
<div id="soil-depth-estimate" class="section level2">
<h2><span class="header-section-number">4.4</span> Soil depth estimate</h2>
<div id="completeness-of-depth-estimate" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Completeness of depth estimate</h3>
<p>Soil properties are commonly collected from field inventories (see Table <a href="preparation.html#tab:horizon-level">4.2</a>) or from sampling and analyzing horizons and/or fixed depths. Since a fixed target depth of 30 cm is required for GSOC (other depth classes will be recommended in the future, following the <a href="http://www.fao.org/3/a-bp164e.pdf"><em>GSP Guidelines for Sharing National Data/Information to Compile a Global Soil Organic Carbon (GSOC) Map</em></a>, data holders are confronted with the following options:</p>
<ul>
<li><strong>Option 1</strong>: Soil sampling has already considered this depth, data can be directly used for upscaling (see Chapter <a href="mappingMethods.html#mappingMethods">6</a>).</li>
<li><strong>Option 2</strong>: Horizons or layers/depth classes are sampled but aggregation is needed over the 0cm to 30cm.</li>
<li><strong>Option 3</strong>: The target depth (0cm to 30cm) was not completely covered by sampling, e.g. only the A horizon or a topsoil layer (e.g. 0cm to 20cm) has been sampled.</li>
</ul>
<p>For both <strong>Options 2</strong> and <strong>Option 3</strong>, the transformation is needed, using e.g. equal-area splines. In the case of <strong>Option 2</strong>, the use of equal-area splines was first proposed by , and later tested against real data . This technique is based on fitting continuous depth functions for modeling the variability of soil properties with depth. Thus, it is possible to convert soil profiles to standard depths, but also to fill gaps. The equal-area spline function consists of a series of local quadratic polynomials that join at so-called knots, located at the horizon boundaries, whereby the mean value of each horizon is maintained by the spline fit. They are called equal-area splines because the area to the left of the fitted spline curve is equal to the area to the right of the curve. In case of <strong>Option 3</strong>, additional information on the vertical distribution of carbon in the soils is required for accurate recalculation from the sampling depth to target depth, e.g. as was shown by .</p>
</div>
<div id="EqualAreaSplines" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Technical steps - Equal-area splines using R</h3>
<p>In <strong>R</strong> environment, the easiest way to apply equal-area splines is using the function <code>GSIF::mpspline</code> from the <strong>R</strong> package <strong>GSIF</strong> (, see Section <a href="setting-up-the-software-environment.html#SoilPedometrics">3.2.2.1</a>). For illustration, a sample dataset has been used (see Chapter <a href="covariates.html#covariates">5</a>). This function requires data stored as <code>SoilProfileCollection</code> (SPC) using package <strong>aqp</strong>. Nevertheless, data in any local soil database or in tables like the ones proposed before (see Tables <a href="preparation.html#tab:site-level">4.1</a>, <a href="preparation.html#tab:horizon-level">4.2</a>) can be transformed to an SPC.</p>
<p>The function <code>GSIF::mpspline</code> has several arguments. One of the arguments is the lambda value mentioned before. The proposed default value is 0.1. Another argument for this function is the target standard depths. The function produces spline-estimated values at these depths. However, this function also produces spline-estimated values at 1cm increments.</p>
<p>The following technical steps require <strong>R</strong> and the named packages.</p>
<p><strong>Step 1 - Promote data table to SPC</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># Load aqp package</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">library</span>(aqp)</a></code></pre></div>
<pre><code>## This is aqp 1.15</code></pre>
<pre><code>## 
## Attaching package: &#39;aqp&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:raster&#39;:
## 
##     metadata, metadata&lt;-</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># Promote to SoilProfileCollection </span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co"># The SoilProfileCollection is a object class in R designed to </span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co"># handle soil profiles</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="kw">depths</span>(dat) &lt;-<span class="st"> </span>ProfID <span class="op">~</span><span class="st"> </span>top <span class="op">+</span><span class="st"> </span>bottom</a></code></pre></div>
<pre><code>## Warning: converting IDs from factor to character</code></pre>
<p><strong>Step 2 - Add site-level data and coordinates</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># Merge the soil horizons information with the site-level </span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co"># information from dat_sites</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="kw">site</span>(dat) &lt;-<span class="st"> </span>dat_sites</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co"># Set spatial coordinates</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="kw">coordinates</span>(dat) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Y</a>
<a class="sourceLine" id="cb33-7" data-line-number="7"></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co"># A summary of our SoilProfileCollection</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9">dat</a></code></pre></div>
<pre><code>## Object of class SoilProfileCollection
## Number of profiles: 4118
## Depth range: 5-295 cm
## 
## Horizon attributes:
##   ProfID    HorID top bottom SOC BLD CRF SAND SILT CLAY
## 1  P0000 P0000H01   4     23  NA  NA  54   52   34   14
## 2  P0000 P0000H02  23     46  NA  NA  62   59   31   11
## 3  P0000 P0000H03  46     59  NA  NA  47   67   24    8
## 4  P0001 P0001H01   2     11  NA  NA  66   45   39   16
## 5  P0001 P0001H02  11     31  NA  NA  70   40   31   28
## 6  P0002 P0002H01   0     22  NA  NA  57   52   33   15
## 
## Sampling site attributes:
##   ProfID X.1                                 soiltype Land.Cover
## 1  P0000   1                                 Cambisol         25
## 2  P0001   2                                 Cambisol         24
## 3  P0002   3                                 Cambisol         25
## 4  P0003   4                        Rendzic Leptosols         26
## 5  P0004   5                        Rendzic Leptosols         26
## 6  P0005   6 Complex of Rendzic Leptosol and Leptosol         27
## 
## Spatial Data:
##        min      max
## X 20.46434 23.01039
## Y 40.68543 42.35932
## [1] NA</code></pre>
<p><strong>Step 3 - Run mass preserving splines for all the needed properties</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">library</span>(GSIF)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co"># Estimate 0 cm - 30 cm standard horizons</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="co"># using mass preserving splines</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="kw">try</span>(SOC &lt;-<span class="st"> </span><span class="kw">mpspline</span>(dat, <span class="st">&#39;SOC&#39;</span>, <span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>))))</a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="kw">try</span>(BLD &lt;-<span class="st"> </span><span class="kw">mpspline</span>(dat, <span class="st">&#39;BLD&#39;</span>, <span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>))))</a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="kw">try</span>(CRFVOL &lt;-<span class="st"> </span><span class="kw">mpspline</span>(dat, <span class="st">&#39;CRF&#39;</span>, <span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>))))</a></code></pre></div>
<p><strong>Step 4 - Convert back to table</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># Prepare final data frame</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> dat<span class="op">@</span>site<span class="op">$</span>ProfID,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">                  <span class="dt">Y =</span> dat<span class="op">@</span>sp<span class="op">@</span>coords[,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">                  <span class="dt">X =</span> dat<span class="op">@</span>sp<span class="op">@</span>coords[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">                  <span class="dt">SOC =</span> SOC<span class="op">$</span>var.std[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">                  <span class="dt">BLD =</span> BLD<span class="op">$</span>var.std[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">                  <span class="dt">CRFVOL =</span> CRFVOL<span class="op">$</span>var.std[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb36-8" data-line-number="8"></a>
<a class="sourceLine" id="cb36-9" data-line-number="9">dat &lt;-<span class="st"> </span>dat[<span class="kw">complete.cases</span>(dat),]</a>
<a class="sourceLine" id="cb36-10" data-line-number="10"></a>
<a class="sourceLine" id="cb36-11" data-line-number="11"><span class="co"># Take a look at the results</span></a>
<a class="sourceLine" id="cb36-12" data-line-number="12"><span class="kw">head</span>(dat)</a></code></pre></div>
<pre><code>##       id        Y        X       SOC       BLD    CRFVOL
## 4  P0003 42.02828 20.81819 26.380000 0.7304483  8.000000
## 5  P0004 42.02747 20.81464 24.561667 0.8955320  6.305316
## 7  P0006 42.02885 20.82757 19.940000 0.7886235 14.000000
## 8  P0007 42.02279 20.83165  6.149114 1.1653355 18.633590
## 9  P0008 42.05014 20.82036  3.940352 1.2962582 31.875748
## 10 P0009 42.02047 20.93529  3.258545 1.3446297 21.714059</code></pre>
<p><strong>Step 5 - Estimate the soil organic carbon stock using the virtual horizons</strong></p>
<p>Finally, the estimation of the soil organic carbon stock (OCS) can be done using the <strong>GSIF</strong> package.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">library</span>(GSIF)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="co"># Estimate organic carbon stock (OCS)</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="co"># SOC must be in g/kg</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="co"># BLD in kg/m3</span></a>
<a class="sourceLine" id="cb38-6" data-line-number="6"><span class="co"># CRF in percentage %</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7">OCSKGM &lt;-<span class="st"> </span><span class="kw">OCSKGM</span>(<span class="dt">ORCDRC =</span> dat<span class="op">$</span>SOC, <span class="dt">BLD =</span> dat<span class="op">$</span>BLD<span class="op">*</span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb38-8" data-line-number="8">                 <span class="dt">CRFVOL =</span> dat<span class="op">$</span>CRFVOL, <span class="dt">HSIZE =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb38-9" data-line-number="9"></a>
<a class="sourceLine" id="cb38-10" data-line-number="10">dat<span class="op">$</span>OCSKGM &lt;-<span class="st"> </span>OCSKGM</a>
<a class="sourceLine" id="cb38-11" data-line-number="11">dat<span class="op">$</span>meaERROR &lt;-<span class="st"> </span><span class="kw">attr</span>(OCSKGM,<span class="st">&quot;measurementError&quot;</span>)</a>
<a class="sourceLine" id="cb38-12" data-line-number="12">dat &lt;-<span class="st"> </span>dat[dat<span class="op">$</span>OCSKGM<span class="op">&gt;</span><span class="dv">0</span>,]</a>
<a class="sourceLine" id="cb38-13" data-line-number="13"></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="kw">summary</span>(dat)</a></code></pre></div>
<pre><code>##        id             Y               X              SOC        
##  P0003  :   1   Min.   :40.69   Min.   :20.46   Min.   : 0.080  
##  P0004  :   1   1st Qu.:41.19   1st Qu.:21.35   1st Qu.: 1.750  
##  P0006  :   1   Median :41.42   Median :21.49   Median : 2.603  
##  P0007  :   1   Mean   :41.49   Mean   :21.66   Mean   : 3.539  
##  P0008  :   1   3rd Qu.:41.83   3rd Qu.:22.14   3rd Qu.: 4.089  
##  P0009  :   1   Max.   :42.36   Max.   :23.01   Max.   :86.510  
##  (Other):3880                                                   
##       BLD              CRFVOL             OCSKGM      
##  Min.   :0.05353   Min.   : 0.00000   Min.   :0.0111  
##  1st Qu.:1.28089   1st Qu.: 0.00516   1st Qu.:0.6951  
##  Median :1.39549   Median : 5.01397   Median :0.9866  
##  Mean   :1.38073   Mean   :11.02257   Mean   :1.1399  
##  3rd Qu.:1.47612   3rd Qu.:17.69065   3rd Qu.:1.3997  
##  Max.   :2.92191   Max.   :93.95013   Max.   :7.4302  
##                                                       
##     meaERROR    
##  Min.   :0.172  
##  1st Qu.:3.160  
##  Median :3.840  
##  Mean   :3.715  
##  3rd Qu.:4.260  
##  Max.   :8.770  
## </code></pre>
<p>Soil organic carbon tends to have a log-normal distribution with a right-skew, and transforming the original values to its natural logarithm would generate a normal distribution of SOC values. Here we will test:</p>
<ol style="list-style-type: decimal">
<li>If the log-transformation of the response variable (SOC) tends to normality; and</li>
<li>If this transformation increases the simple correlation of SOC and its prediction factors.</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="co"># Generate a new column with the transformed OCSKGM to its natural </span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co"># logarithm</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3">dat<span class="op">$</span>OCSKGMlog &lt;-<span class="st"> </span><span class="kw">log</span>(dat<span class="op">$</span>OCSKGM)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="co"># Plot the next two plots as one</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="kw">plot</span>(<span class="kw">density</span>(dat<span class="op">$</span>OCSKGM),</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">     <span class="dt">main=</span><span class="st">&#39;Original values&#39;</span>)</a>
<a class="sourceLine" id="cb40-9" data-line-number="9"></a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="kw">plot</span>(<span class="kw">density</span>(dat<span class="op">$</span>OCSKGMlog),</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">     <span class="dt">main=</span><span class="st">&#39;Log-transformed values&#39;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-16"></span>
<img src="SOCMapping_files/figure-html/unnamed-chunk-16-1.png" alt="Statistical distribution of original values vs. log-transformed values for OCS " width="672" />
<p class="caption">
Figure 4.3: Statistical distribution of original values vs. log-transformed values for OCS
</p>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="co"># We can save our processed data as a *.csv table</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="kw">write.csv</span>(dat, <span class="st">&quot;data/dataproc.csv&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-baritz2008environmental">
<p>Baritz, R, E Eberhardt, MH Van Liedekerke, and P Panagos. 2008. “Environmental Assessment of Soil for Monitoring: Volume Iii Database Design and Selection.” <em>EUR</em> 23490:125.</p>
</div>
<div id="ref-gsp_guidelines_2017">
<p>FAO, and GSP. 2017a. “GSP Guidelines for Sharing National Data/Information to Compile a Global Soil Organic Carbon (Gsoc) Map - Pillar 4 Working Group.” Rome, Italy. <a href="http://www.fao.org/3/a-bs975e.pdf" class="uri">http://www.fao.org/3/a-bs975e.pdf</a>.</p>
</div>
<div id="ref-USDA_2018">
<p>Agriculture. 2018. “Estimating Moist Bulk Density by Texture. General Guide for Estimating Moist Bulk Density (One-Tenth and One-Third Bar).” 2018. <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/office/ssr10/tr/?cid=nrcs144p2_074844" class="uri">https://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/office/ssr10/tr/?cid=nrcs144p2_074844</a>.</p>
</div>
<div id="ref-united1975soil">
<p>Agriculture. Soil Conservation Service, United States Department of. 1975. <em>Soil Taxonomy: A Basic System of Soil Classification for Making and Interpreting Soil Surveys</em>. 436. US Department of Agriculture.</p>
</div>
<div id="ref-barney_forest_1981">
<p>Barney, Richard J., Collin D. Bevins, Larry S. Bradshaw, Mont ) Forestry Sciences Laboratory (Missoula, United States. Forest Service, and Utah) Intermountain Forest and Range Experiment Station (Ogden. 1981. <em>Forest Floor Fuel Loads, Depths and Bulk Densities in Four Interior Alaskan Cover Types</em>. Ogden, Utah : U.S. Dept. of Agriculture, Forest Service, Intermountain Forest; Range Experiment Station. <a href="http://archive.org/details/forestfloorfuell304barn" class="uri">http://archive.org/details/forestfloorfuell304barn</a>.</p>
</div>
<div id="ref-ottmar_litter_2007">
<p>Ottmar, Roger, and Anne Andreu. 2007. “Litter and Duff Bulk Densities in the Southern United States: Final Report for Joint Fire Sciences Program, Project 04-2-1-49.” Pacific Northwest. <a href="https://www.firescience.gov/projects/04-2-1-49/project/04-2-1-49_final_report.pdf" class="uri">https://www.firescience.gov/projects/04-2-1-49/project/04-2-1-49_final_report.pdf</a>.</p>
</div>
<div id="ref-agus_measuring_2011">
<p>Agus, Fahmuddin, Kurniatun Hairiah, and Anny Mulyani. 2011. “Measuring Carbon Stock in Peat Soils: Practical Guidelines World Agroforestry Centre.” Bogor, Indonesia: World Agroforestry Centre (ICRAF) Southeast Asia Regional Program, Indonesian Centre for Agricultural Land Resources Research; Development. <a href="http://www.worldagroforestry.org/publication/measuring-carbon-stock-peat-soils-practical-guidelines" class="uri">http://www.worldagroforestry.org/publication/measuring-carbon-stock-peat-soils-practical-guidelines</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setting-up-the-software-environment.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="covariates.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/04-preparation-soil-data.Rmd",
"text": "Edit"
},
"download": ["SOCMapping.pdf", "SOCMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
