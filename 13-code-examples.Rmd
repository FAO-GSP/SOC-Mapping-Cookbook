# Compendium of the code examples included in the cookbook {#compendium}
*G.F. Olmedo*

This cookbook is a step-by-step manual starting with the soil data preparation, producing the map, and finishing with map validation and data sharing (Fig \@ref(fig:grworkflow)). In the different chapters, we present a continuing example using the FYROM soil database and some environmental covariates. On every chapter with start with the input data and produce the proposed output, which is usually the input for the following chapter. The soil data needed can be downloaded from the [data repository](https://github.com/FAO-GSP/SOC-Mapping-Cookbook/tree/master/data), and the same applies to the [environmental covariates](https://github.com/FAO-GSP/SOC-Mapping-Cookbook/tree/master/covs). The results obtained in every chapter can be also downloaded for comparison purposes from the [result folder](https://github.com/FAO-GSP/SOC-Mapping-Cookbook/tree/master/results). Finally, all the needed code is summarized in this chapter and can be downloaded from the [code folder](https://github.com/FAO-GSP/SOC-Mapping-Cookbook/tree/master/code).

Following this, we present a compendium of the technical steps presented in the previous Chapters of the cookbook. With the help of these examples, the user should be able to produce a soil property prediction map starting from the soil samples, covariates preparation, modeling and ending with the validation. However, we present different alternatives for the different steps. This proposed framework to prepare a soil property prediction map includes soil data preparation, covariates preparation, overlaying soil data and covariates, fitting a model for the spatial interpolation and validation:

1. Soil data preparation
  - **Option A**: Data Preparation - Soil Profiles (Code \@ref(cd:PreparationProfiles))
  - **Option B**: Data Preparation - Top Soil or Auger Samples (Code \@ref(cd:PreparationAuger))
  - *[optional]*: Data Preparation - Merging Top Soil/Auger Samples and Soil Profiles (Code \@ref(cd:merging))
  - *[optional]*: Split the soil data in test and validations datasets (Code \@ref(cd:data-splitting))
2. Covariates preparation
  - *[optional]* Rasterizing a Vector Layer in R (Code \@ref(cd:Rasterizing))
  - Overlay Covariates and Soil Points Data (Code \@ref(cd:Overlay))
3. Spatial interpolation model
  - **Option A**: Fitting a Regression-kriging model to predict the OCS (Code \@ref(cd:RK))
  - **Option B**: Fitting a Random Forest model to predict the SOC (Code \@ref(cd:rf))
  - **Option C**: Fitting a Support Vector Machines model to predict the SOC (Code \@ref(cd:svm))
4. Validation
  - Quality measures for quantitative data (Code \@ref(cd:Validation))
  - *[optional]* Graphical quality measures for quantitative data (Code \@ref(cd:Graphs))
  - *[optional]* Cross-validation for Regression-kriging models (Code \@ref(cd:xvalRK))
  - *[optional]* Validation of Random Forest using Quantile Regression Trees (Code \@ref(cd:quantreg))
5. Model Evaluation
  - Model Evaluation (Code \@ref(cd:Evaluation))
  
  
\clearpage
## Data preparation for soil profiles{#cd:PreparationProfiles}

The extended and discussed version of the following code is presented in Chapter \@ref(preparation), by G.F. Olmedo & R. Baritz.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/1A-DataPreparation-Profiles.R")
```


```{r 1A-DataPreparation-Profiles, eval=FALSE}

```


\clearpage
## Data preparation for top soil or auger samples {#cd:PreparationAuger}  

The extended and discussed version of the following code is presented in Chapter \@ref(preparation), by G.F. Olmedo & R. Baritz.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/1B-DataPreparation-Augers.R")
```


```{r 1B-DataPreparation-Augers, eval=FALSE}

```


\clearpage
## Merging top soil and soil profiles Databases{#cd:merging}


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/optional-Merging.R")
```


```{r optional-Merging, eval=FALSE}

```


\clearpage
## Data-splitting{#cd:data-splitting}

The extended and discussed version of the following code is presented in Chapter \@ref(chvalidation), by B. Kempen, D.J. Brus & G.B.M. Heuvelink, with code contributions from G.F. Olmedo.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/optional-DataSplitting.R")
```


```{r optional-DataSplitting, eval=FALSE}

```


\clearpage
## Rasterizing a vector layer in R {#cd:Rasterizing}

The extended and discussed version of the following code is presented in Chapter \@ref(covariates), by R. Baritz & Y. Yigini.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/optional-Rasterizing.R")
```


```{r optional-Rasterizing, eval=FALSE}

```


\clearpage
## Overlay covariates and soil points Data{#cd:Overlay}

The extended and discussed version of the following code is presented in Chapter \@ref(covariates), by R. Baritz & Y. Yigini.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/2-OverlayCovariates.R")
```


```{r 2-OverlayCovariates, eval=FALSE}

```


\clearpage
##	Fitting a regression-kriging model to predict the OCS	{#cd:RK}

The extended and discussed version of the following code is presented in Section  \@ref(RK), by G.F. Olmedo & Y. Yigini.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/3A-1-RegressionKriging.R")
```


```{r 3A-1-RegressionKriging, eval=FALSE}

```


## 	Cross-validation of regression-kriging models	 {#cd:xvalRK}

The extended and discussed version of the following code is presented in Section  \@ref(RK), by G.F. Olmedo & Y. Yigini.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/3A-2-XvalRegressionKriging.R")
```


```{r 3A-2-XvalRegressionKriging, eval=FALSE}

```


\clearpage
## Fitting a random forest model to predict the SOC	{#cd:rf}

The extended and discussed version of the following code is presented in Section \@ref(rf), by M. Guevara, C. Thine, G.F. Olmedo & R.R. Vargas.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/3B-1-randomForest.R")
```


```{r 3B-1-randomForest, eval=FALSE}

```


\clearpage
## Using quantile regression forest to estimate uncertainty {#cd:quantreg}

The extended and discussed version of the following code is presented in Section \@ref(rf), by M. Guevara, C. Thine, G.F. Olmedo & R.R. Vargas.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/3B-2-QuantileRegressionForest.R")
```


```{r 3B-2-QuantileRegressionForest, eval=FALSE}

```


\clearpage
## Fitting a SVM model to predict the SOC	{#cd:svm}

The extended and discussed version of the following code is presented in Section \@ref(svm), by G.F. Olmedo & M. Guevara.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/3C-SupportVectorMachines.R")
```


```{r 3C-SupportVectorMachines, eval=FALSE}

```


\clearpage
## Validation{#cd:Validation}

The extended and discussed version of the following code is presented in Chapter \@ref(chvalidation), by B. Kempen, D.J. Brus & G.B.M. Heuvelink, with code contributions from G.F. Olmedo.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/4-1-Validation.R")
```


```{r 4-1-Validation, eval=FALSE}

```


\clearpage
## Graphical map quality measures {#cd:Graphs}

The extended and discussed version of the following code is presented in Chapter \@ref(chvalidation), by B. Kempen, D.J. Brus & G.B.M. Heuvelink, with code contributions from G.F. Olmedo.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/4-2-GraphicalQualityMeasures.R")
```


```{r 4-2-GraphicalQualityMeasures, eval=FALSE}

```


\clearpage
## Model evaluation {#cd:Evaluation}

The extended and discussed version of the following code is presented in Chapter \@ref(evaluation), by M. Guevara and G.F. Olmedo.


```{r, echo=FALSE, cache=FALSE}
knitr::read_chunk(path = "code/5-ModelEvaluation.R")
```


```{r 5-ModelEvaluation, eval=FALSE}

```


`r if (knitr:::is_html_output()) '# References {-}'`
